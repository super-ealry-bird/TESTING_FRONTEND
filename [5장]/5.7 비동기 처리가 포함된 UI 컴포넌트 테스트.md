# Chapter 5. UI ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
### 5.7 ë¹„ë™ê¸° ì²˜ë¦¬ê°€ í¬í•¨ëœ UI zjavhsjsxm xptmxm
> Fetch API ë¡œ ì „ì†¡í•˜ë ¤ë©´?

<br/>

### 5.7.1 í…ŒìŠ¤íŠ¸í•  UI ì»´í¬ë„ŒíŠ¸
> ê³„ì • ì •ë³´ ë“±ë¡ í˜ì´ì§€ë¥¼ í‘œì‹œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸

```shell
ì›¹ API ì‘ë‹µ > postResult ì— ë©”ì‹œì§€ ì €ì¥ > í‘œì‹œ
Form ì»´í¬ë„ŒíŠ¸ëŠ” onSubmit ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ë‹¤ìŒ í•¨ìˆ˜ ì‹¤í–‰
```

```ts
import { useState } from "react";
import { Form } from "../06/Form";
import { postMyAddress } from "./fetchers";
import { handleSubmit } from "./handleSubmit";
import { checkPhoneNumber, ValidationError } from "./validations";

export const RegisterAddress = () => {
  const [postResult, setPostResult] = useState("");
  return (
    <div>
      <Form
        onSubmit={handleSubmit((values) => { //form ì— ì „ì†¡ëœ ê°’ì„ values ë¼ëŠ” ê°ì²´ë¡œ ë³€í™˜
          try {
            checkPhoneNumber(values.phoneNumber); //ì „ì†¡ëœ ê°’ ìœ íš¨ì„± ê²€ì‚¬ 
            postMyAddress(values) //ì›¹ API í´ë¼ì´ì–¸íŠ¸ í˜¸ì¶œ
              .then(() => {
                setPostResult("ë“±ë¡ëìŠµë‹ˆë‹¤");
              })
              .catch(() => {
                setPostResult("ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
              });
          } catch (err) {
            if (err instanceof ValidationError) {
              setPostResult("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤");
              return;
            }
            setPostResult("ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");
          }
        })}
      />
      {postResult && <p>{postResult}</p>}
    </div>
  );
};
```

<p align="center">
<img width="482" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-08-13 02 26 08" src="https://github.com/user-attachments/assets/6c81b762-9979-483d-9df0-a4d7bcfa2c81">
</p>

<br />

>ì›¹ API ì‘ë‹µì— ë”°ë¼ ë„¤ê°€ì§€ íŒ¨í„´ìœ¼ë¡œ ë‹¤ë¥¸ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ëŠ”ì§€ ì¤‘ì ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì

<br />

### 5.7.2 ì›¹ API í´ë¼ì´ì–¸íŠ¸ í™•ì¸
> valuesë¡œ ë³€í™˜ëœ ê°’ì€ Fetch API ë¥¼ í™œìš©í•˜ëŠ” ì›¹ API í´ë¼ì´ì–¸íŠ¸ì¸ postMyAddress ì—ì„œ ì‚¬ìš©

```shell
postMyAddress ë¥¼ í™œìš©í•´ì„œ HTTP ìƒíƒœê°€ 300ë²ˆ ì´ìƒì´ë©´ ì˜ˆì™¸ ë°œìƒ
```

```ts
export function postMyAddress(values: unknown): Promise<Result> {
  return fetch(host("/my/address"), {
    method: "POST",
    body: JSON.stringify(values),
    headers,
  }).then(handleResponse);
}
```

<br/>

### 5.7.3  ì›¹ API í´ë¼ì´ì–¸íŠ¸ì˜ ëª© í•¨ìˆ˜
> postMyAddress ë¥¼ ëª© ê°ì²´ë¡œ ë§Œë“œëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ë ¤ë©´? (Ch.4)

```ts
import * as Fetchers from ".";
import { httpError, postMyAddressMock } from "./fixtures";

export function mockPostMyAddress(status = 200) {
  if (status > 299) {
    return jest
      .spyOn(Fetchers, "postMyAddress")
      .mockRejectedValueOnce(httpError);
  }
  return jest
    .spyOn(Fetchers, "postMyAddress")
    .mockResolvedValueOnce(postMyAddressMock);
}
```

<br/>

### 5.7.4 ì…ë ¥ëœ ê°’ì„ ì „ì†¡í•˜ëŠ” ì¸í„°ë™ì…˜ í•¨ìˆ˜
> ui ë¥¼ ì¡°ì‘í•´ì„œ ì „ì†¡ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì–´ë–¤ ê²°ê³¼ê°€ ë‚˜íƒ€ë‚ ê¹Œ?
>
> ì…ë ¥ë€ì— ëª¨ë‘ ì…ë ¥ í›„ ì „ì†¡í•˜ëŠ” ê³¼ì • = **ë¹„ë™ê¸° í•¨ìˆ˜** ë¡œ ì •ë¦¬

```ts
async function fillValuesAndSubmit() {
  const contactNumber = await inputContactNumber();
  const deliveryAddress = await inputDeliveryAddress();
  const submitValues = { ...contactNumber, ...deliveryAddress };
  await clickSubmit();
  return submitValues;
}
```


<br/>

### 5.7.5 ì‘ë‹µ ì„±ê³µ í…ŒìŠ¤íŠ¸
> ì„±ê³µí•˜ëŠ” íŒ¨í„´ì˜ í…ŒìŠ¤íŠ¸
>
> mockPostMyAddress í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì›¹ API í´ë¼ì´ì–¸íŠ¸ì˜ ì‘ë‹µì´ ë³€ê²½ëœë‹¤.

<br/>

ğŸ’¡ ëª© ëª¨ë“ˆì„ ì‚¬ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸ëŠ” íŒŒì¼ìƒë‹¨ì— jest.mock(ëª¨ë“ˆ ê²½ë¡œ); ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ìŠì§€ë§ì! 

```ts
jest.mock("./fetchers");

test("ì„±ê³µí•˜ë©´ 'ë“±ë¡ëìŠµë‹ˆë‹¤'ê°€ í‘œì‹œëœë‹¤", async () => {
  const mockFn = mockPostMyAddress();
  render(<RegisterAddress />);
  const submitValues = await fillValuesAndSubmit();
  expect(mockFn).toHaveBeenCalledWith(expect.objectContaining(submitValues));
  expect(screen.getByText("ë“±ë¡ëìŠµë‹ˆë‹¤")).toBeInTheDocument();
});
```


<br/>

### 5.7.6 ì‘ë‹µ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸
> ì›¹ API ì˜ ì‘ë‹µì´ reject ë˜ëŠ” ìƒí™©ì„ ì¬í˜„í•˜ê³ ì ëª© í•¨ìˆ˜ì˜ ì¸ìˆ˜ë¡œ 500 ì„¤ì •

```ts
jest.mock("./fetchers");

test("ì‹¤íŒ¨í•˜ë©´ 'ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤'ê°€ í‘œì‹œëœë‹¤", async () => {
  const mockFn = mockPostMyAddress(500);
  render(<RegisterAddress />);
  const submitValues = await fillValuesAndSubmit();
  expect(mockFn).toHaveBeenCalledWith(expect.objectContaining(submitValues));
  expect(screen.getByText("ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")).toBeInTheDocument();
});
```

<br/>

### 5.7.7 ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸
> ì „ì†¡í•˜ë ¤ëŠ” ê°’ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•˜ë©´ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì…ë ¥ê°’ì´ í¬í•¨ëœ ê²½ìš°ì—ëŠ” ì „ì†¡ ìì²´ê°€ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ ì˜¬ë°”ë¥¸ ê°’ì„ ì…ë ¥í•˜ë„ë¡ ë„ìš¸ ìˆ˜ ìˆë‹¤.

```shell
checkPhoneNumber : ì „í™”ë²ˆí˜¸ ì…ë ¥ê°’ì„ ê²€ì¦í•˜ëŠ” ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
try-catch ë¬¸ì„ í†µí•´ errê°€ validationErrorì˜ ì¸ìŠ¤í„´ìŠ¤ì´ë©´ ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ë¡œ ê°„ì£¼
```

```ts
<Form
        onSubmit={handleSubmit((values) => {
          try {
            checkPhoneNumber(values.phoneNumber);
            postMyAddress(values)
              .then(() => {
                setPostResult("ë“±ë¡ëìŠµë‹ˆë‹¤");
              })
              .catch(() => {
                setPostResult("ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
              });
          } catch (err) {
            if (err instanceof ValidationError) { //ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ë¡œ ê°„ì£¼
              setPostResult("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤");
              return;
            }
            setPostResult("ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");
          }
        })}
      />
```
```ts
export class ValidationError extends Error {}

export function checkPhoneNumber(value: any) {
  if (!value.match(/^[0-9\-]+$/)) {
    throw new ValidationError();
  }
}
```

<br/>

**[ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë„ë¡  ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ìœ¼ë¡œ ë³€ê²½ í›„ í…ŒìŠ¤íŠ¸ ]**

```shell
ìœ íš¨ì„± ê²€ì‚¬ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë„ë¡ fillInvalidValesAndSumbit ì„ ì‘ì„±í•´ë³´ì
```
```ts
async function fillInvalidValuesAndSubmit() {
  const contactNumber = await inputContactNumber({
    name: "ë°°ì–¸ìˆ˜",
    phoneNumber: "abc-defg-hijkl", //ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ìœ¼ë¡œ ë³€ê²½
  });
  const deliveryAddress = await inputDeliveryAddress();
  const submitValues = { ...contactNumber, ...deliveryAddress };
  await clickSubmit();
  return submitValues;
}
```

<br />

**[ AAA íŒ¨í„´ ]**
> ì¤€ë¹„ > ì‹¤í–‰ > ê²€ì¦ 3ì”ê³„ë¡œ ì •ë¦¬í•œ ê°€ë…ì„±ì´ ì¢‹ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œ

```ts
test("ìœ íš¨ì„± ê²€ì‚¬ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ë©”ì‹œì§€ê°€ í‘œì‹œëœë‹¤", async () => {
  render(<RegisterAddress />); //ì¤€ë¹„
  await fillInvalidValuesAndSubmit(); //ì‹¤í–‰
  expect(screen.getByText("ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤")).toBeInTheDocument(); //ê²€ì¦
});
```

<br/>

### 5.7.8 ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸
> ëª© í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šì€ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì›¹ API ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ê¸°ì— ì›ì¸ ë¶ˆëª…ì˜ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

```ts
test("ì›ì¸ì´ ëª…í™•í•˜ì§€ ì•Šì€ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ë©”ì‹œì§€ê°€ í‘œì‹œëœë‹¤", async () => {
  render(<RegisterAddress />);
  await fillValuesAndSubmit();
  expect(screen.getByText("ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")).toBeInTheDocument();
});
});
```

<br/>

---

<br/>


ğŸ’¡ ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ìˆë‹¤ë©´ ì˜¤ë¥˜ ë¶„ê¸°ê°€ ë³µì¡í•´ì§€ëŠ” ìƒí™©ì´ ë§ê¸°ì— í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë©´ì„œ ëˆ„ë½ëœ ë¶€ë¶„ì€ ì—†ëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤.


