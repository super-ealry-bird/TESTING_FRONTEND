# Chapter 7. ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ í†µí•© í…ŒìŠ¤íŠ¸
## 7.1 Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œê³¼ í†µí•© í…ŒìŠ¤íŠ¸
> 7ì¥ë¶€í„°ëŠ” ì•„ë˜ ì €ì¥ì†Œì— ìˆëŠ” Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì˜ˆì œë¡œ ì‚¬ìš©í•œë‹¤.
> <br/> https://github.com/frontend-testing-book-kr/nextjs

### 7.1.1 ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œìš”

* ê¸°ìˆ  ê´€ë ¨ ê¸°ì‚¬ë¥¼ ì‘ì„±í•˜ê³  ê³µìœ í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜

### 7.1.2 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ê¸°

ìœ„ì˜ ì €ì¥ì†Œë¥¼ í´ë¡ í•˜ê³  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ê¸°

```shell
$ npm i
$ npm test
$ open __reports__/jest.html
```
ğŸ“ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ê²°ê³¼

![img_1.png](images/img_1.png)

ğŸ“Š ë¦¬í¬íŠ¸
![img.png](images/img.png)

<br/>

## 7.2 React Contextì™€ í†µí•© í…ŒìŠ¤íŠ¸

### 7.2.1 í…ŒìŠ¤íŠ¸í•  UI ì»´í¬ë„ŒíŠ¸

* `<Toast />` ì»´í¬ë„ŒíŠ¸
  * ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‘ë‹µ ê²°ê³¼ë¥¼ í†µì§€í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
  * ëª¨ë“  í™”ë©´ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ì „ì—­ UI
 
  ![image](https://github.com/user-attachments/assets/5a332911-5beb-4917-8084-abe40b785e29)

<br />

Toast ì»´í¬ë„ŒíŠ¸ì™€ ê°™ì€ ì „ì—­ UIë¥¼ ë‹¤ë£° ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ìˆ  **Context API**

> ğŸ’¡ Context APIë€?
> 
> Propsë¡œ ê°’ì„ ì „ë‹¬í•  í•„ìš” ì—†ì´ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸ê°€ ì†Œìœ í•œ ê°’ê³¼ ê°±ì‹  í•¨ìˆ˜ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ë¦¬ì•¡íŠ¸ ê³µì‹ API


**[ Context API ì‚¬ìš©ë²• ]**

1. `<Toast />` ì»´í¬ë„ŒíŠ¸ì˜ ë Œë”ë§ì„ ê²°ì •í•˜ëŠ” ìƒíƒœì˜ ì´ˆê¹ƒê°’ ì„¸íŒ…
```ts
export const initialState: ToastState = {
  isShown: false,
  message: "",
  style: "succeed",
};
```

2. createContext API ë¥¼ ì‚¬ìš©í•´ `Context` ìƒì„±
```ts
export const ToastStateContext = createContext(initialState);
export const ToastActionContext = createContext(initialAction);
```
* ToastStateContext : ìƒíƒœë¥¼ ì†Œìœ í•  Context
* ToastActionContext : ìƒíƒœ ê°±ì‹  í•¨ìˆ˜ë¥¼ ì†Œìœ í•  Context

3. ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸ `ToastProvider` ë Œë”ë§

```ts
export const ToastProvider = ({
  children,
  defaultState,
}: {
  children: ReactNode;
  defaultState?: Partial<ToastState>;
}) => {
  const { isShown, message, style, showToast, hideToast } =
    useToastProvider(defaultState);
  return (
    {/* í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ isShown, message, styleì„ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤ */}
    <ToastStateContext.Provider value={{ isShown, message, style }}>
      {/* í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ showToast, hideToastë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤ */}
      <ToastActionContext.Provider value={{ showToast, hideToast }}>
        {children}
        {/* isShownì´ trueê°€ ë˜ë©´ í‘œì‹œëœë‹¤ */}
        {isShown && <Toast message={message} style={style} />}
      </ToastActionContext.Provider>
    </ToastStateContext.Provider>
  );
};
```
* 2ì—ì„œ ìƒì„±í•œ `Context` ê°ì²´ê°€ ì†Œìœ í•œ `Provide` ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§
* ToastProviderë¡œ ê°ì‹¸ë©´ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ `children`ì—ì„œ ìƒíƒœì™€ ìƒíƒœ ê°±ì‹  í•¨ìˆ˜ì— ì ‘ê·¼ ê°€ëŠ¥
 
4. í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸°
```ts
import { useContext } from "react";
import { ToastActionContext } from "./ToastContext";

export function useToastAction() {
  return useContext(ToastActionContext);
}
```
```ts
const { showToast } = useToastAction();
const onSubmit = handleSubmit(async (input) => {
  try {
    // ... ì›¹ APIì— ê°’ì„ ì „ì†¡í•œë‹¤.
    showToast({ message: "ì €ì¥ëìŠµë‹ˆë‹¤.", style: "succeed" });
  } catch (err) {
    showToast({ message: "ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", style: "failed" });
  }
});
```
* í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” `useContext`ë¥¼ ì‚¬ìš©í•´ ì ‘ê·¼
* ì˜ˆì œì—ì„œëŠ” custom hooksë¡œ ë§Œë“¤ì–´ì„œ ì¤‘ë³µëœ ì½”ë“œ ì‚¬ìš© â¬‡ï¸

Toast ì»´í¬ë„ŒíŠ¸ì™€ ê°™ì€ ì „ì—­ UIë¥¼ ëŒ€ìƒìœ¼ë¡œ ì‹¤ì‹œí•˜ëŠ” í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì‚¬í•­ì„ ì¤‘ì ìœ¼ë¡œ ë‘”ë‹¤.

>- `Provider`ì˜ ìƒíƒœì— ë”°ë¼ ë Œë”ë§ ì—¬ë¶€ê°€ ë³€ê²½ëœë‹¤.
>- `Provider`ì˜ ê°±ì‹  í•¨ìˆ˜ë¡œ ìƒíƒœë¥¼ ê°±ì‹ í•  ìˆ˜ ìˆë‹¤.


<br />

### 7.2.2 ë°©ë²•â‘  í…ŒìŠ¤íŠ¸ìš© ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ ì¸í„°ë™ì…˜ ì‹¤í–‰í•˜ê¸°

ì „ì—­ UIë¥¼ ëŒ€ìƒìœ¼ë¡œ Contextë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì²« ë²ˆì§¸ ë°©ë²• : **í…ŒìŠ¤íŠ¸ìš© ì»´í¬ë„ŒíŠ¸ ë§Œë“¤ê¸°**

* í…ŒìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸
```ts
const TestComponent = ({ message }: { message: string }) => {
  const { showToast } = useToastAction(); // <Toast>ë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•œ í›…
  return <button onClick={() => showToast({ message })}>show</button>;
};
```

* í…ŒìŠ¤íŠ¸ ì½”ë“œ
```ts
test("showToastë¥¼ í˜¸ì¶œí•˜ë©´ Toastì»´í¬ë„ŒíŠ¸ê°€ í‘œì‹œëœë‹¤", async () => {
  const message = "test";
  // 1. Providerì™€ í…ŒìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
  render(
    <ToastProvider>
      <TestComponent message={message} />
    </ToastProvider>
  );
  // 2. ì²˜ìŒì—ëŠ” ë Œë”ë§ë˜ì§€ ì•ŠìŒì„ í…ŒìŠ¤íŠ¸
  expect(screen.queryByRole("alert")).not.toBeInTheDocument();
  // 3. í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ
  await user.click(screen.getByRole("button"));
  // 4. ë Œë”ë§ëëŠ”ì§€ í…ŒìŠ¤íŠ¸
  expect(screen.getByRole("alert")).toHaveTextContent(message);
});
```

<br/>

### 7.2.3 ë°©ë²•â‘¡ ì´ˆê¹ƒê°’ì„ ì£¼ì…í•´ì„œ ë Œë”ë§ëœ ë‚´ìš© í™•ì¸í•˜ê¸°

ì „ì—­ UIë¥¼ ëŒ€ìƒìœ¼ë¡œ Contextë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë‘ ë²ˆì§¸ ë°©ë²• : **ì´ˆê¹ƒê°’ ì£¼ì…** \
ë‹¨ìˆœíˆ ë Œë”ë§ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš© (ì´ˆê¹ƒê°’ì„ ì„¤ì •í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„ í•„ìš”)

* í…ŒìŠ¤íŠ¸ ì½”ë“œ
```ts
test("Succeed", () => {
  const state: ToastState = {
    isShown: true,
    message: "ì„±ê³µí–ˆìŠµë‹ˆë‹¤",
    style: "succeed",
  };
  render(<ToastProvider defaultState={state}>{null}</ToastProvider>);
  expect(screen.getByRole("alert")).toHaveTextContent(state.message);
});

test("Failed", () => {
  const state: ToastState = {
    isShown: true,
    message: "ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",
    style: "failed",
  };
  render(<ToastProvider defaultState={state}>{null}</ToastProvider>);
  expect(screen.getByRole("alert")).toHaveTextContent(state.message);
});
```

> ğŸ’¡ ì´ˆê¹ƒê°’ì„ ì£¼ì…í•˜ëŠ” ë‘ ë²ˆì§¸ ë°©ë²•ë³´ë‹¤ëŠ” Toast ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•˜ê³  ì¡°ì‘í•˜ëŠ” ë° í•„ìš”í•œ ì•„ë˜ ë„¤ ê°€ì§€ ëª¨ë“ˆì„ ëª¨ë‘ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” ì²« ë²ˆì§¸ ë°©ë²•ì´ ë” ë„“ì€ ë²”ìœ„ì˜ í†µí•© í…ŒìŠ¤íŠ¸ì´ë‹¤.
> * `Toast` : view ì œê³µ ë° í…ŒìŠ¤íŠ¸í•  ì»´í¬ë„ŒíŠ¸
> * `ToastProvider` : ë Œë”ë§ ì—¬ë¶€ë¥¼ ê²°ì •í•  ìƒíƒœë¥¼ ì†Œìœ 
> * `useToastProvider` : ë Œë”ë§ ê´€ë ¨ ë¡œì§ì„ ê´€ë¦¬ 
> * `useToastAction, useToastState` : í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ í˜¸ì¶œí•˜ëŠ” hooks

<br/>

## 7.3 Next.js ë¼ìš°í„°ì™€ ë Œë”ë§ í†µí•© í…ŒìŠ¤íŠ¸

### 7.3.1 í…ŒìŠ¤íŠ¸í•  UI ì»´í¬ë„ŒíŠ¸

* `<Nav />` ì»´í¬ë„ŒíŠ¸
  * í—¤ë” ë‚´ë¹„ê²Œì´ì…”ì„ ë‹´ë‹¹í•˜ëŠ” UI ì»´í¬ë„ŒíŠ¸
  * URLì— ë”°ë¼ ë‚´ë¹„ê²Œì´ì…˜ ë©”ë‰´ì— í˜„ì¬ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ëƒ„

![image](https://github.com/user-attachments/assets/d27fd5d6-59c4-43fe-b750-a96649d5642e)


<br />

### 7.3.2 UI ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

Nav ì»´í¬ë„ŒíŠ¸ëŠ” aíƒœê·¸ì— `aria-current` ë¼ëŠ” ì†ì„±ì„ ì‚¬ìš©í•´ì„œ ìŠ¤íƒ€ì¼ì„ ì ìš©í•˜ê³  ìˆë‹¤.
```html
<a aria-current="page">Create Post</a>
```

```css
.list a[aria-current="page"] {
  border-color: var(--orange);
}
```
`aria-current` ì†ì„±ì„ ê°€ì§€ëŠ” ë§ˆí¬ì—…ì„ ì¶œë ¥í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” isCurrent í•¨ìˆ˜

```ts
function isCurrent(flag: boolean): AnchorHTMLAttributes<HTMLAnchorElement> {
  if (!flag) return {};
  return { "aria-current": "page" };
}
```

```ts
<a {...isCurrent(pathname === "/my/posts/create")}>Create Post</a>
```
í˜„ì¬ URL ì •ë³´ì¸ pathnameì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œ Next.jsì˜ useRouter í›…ì„ ì‚¬ìš©
```ts
const { pathname } = useRouter();
```
***ìœ„ì™€ ê°™ì´ Next.jsì˜ ë¼ìš°í„°ì™€ ê´€ë ¨ëœ ì»´í¬ë„ŒíŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ëª© ê°ì²´ê°€ í•„ìš”!***

<br />

### 7.3.3 next-router-mock ì„¤ì¹˜

> ğŸ’¡ next-router-mock ì´ë€?
>
> ì œìŠ¤íŠ¸ì—ì„œ Next.jsì˜ ë¼ìš°í„°ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë„ë¡ ëª© ê°ì²´ë¥¼ ì œê³µí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

```shell
$ npm install --save-dev next-router-mock
```

<br />

### 7.3.4 ë¼ìš°í„°ì™€ UI ì»´í¬ë„ŒíŠ¸ í†µí•© í…ŒìŠ¤íŠ¸
`next-router-mock`ì„ ì‚¬ìš©í•´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±
* í…ŒìŠ¤íŠ¸ ì½”ë“œ
```ts
test("í˜„ì¬ ìœ„ì¹˜ëŠ” 'My Posts'ì´ë‹¤", () => {
  // 1. setCurrentUrlë¥¼ ì‚¬ìš©í•´ í…ŒìŠ¤íŠ¸ í™˜ê²½ì˜ URL ì„¤ì •
  mockRouter.setCurrentUrl("/my/posts");
  // 2. í…ŒìŠ¤íŠ¸ ëŒ€ìƒì¸ Nav ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
  render(<Nav onCloseMenu={() => {}} />);
  // 3. aria-current ì†ì„±ì„ ê²€ì¦í•´ í…ŒìŠ¤íŠ¸
  const link = screen.getByRole("link", { name: "My Posts" });
  expect(link).toHaveAttribute("aria-current", "page");
});
```

<br />

### 7.3.5 test.each í™œìš©

* ë™ì¼í•œ í…ŒìŠ¤íŠ¸ë¥¼ ë§¤ê°œë³€ìˆ˜ë§Œ ë³€ê²½í•´ ë°˜ë³µí•˜ê³  ì‹¶ì€ ê²½ìš° -> `test.each` í™œìš©

```ts
test.each([
  { url: "/my/posts", name: "My Posts" },
  { url: "/my/posts/123", name: "My Posts" },
  { url: "/my/posts/create", name: "Create Post" },
])("$urlì˜ í˜„ì¬ ìœ„ì¹˜ëŠ” $nameì´ë‹¤", ({ url, name }) => {
  mockRouter.setCurrentUrl(url);
  render(<Nav onCloseMenu={() => {}} />);
  const link = screen.getByRole("link", { name });
  expect(link).toHaveAttribute("aria-current", "page");
});
```

> ğŸ’¡Next.js 13ë²„ì „ì—ëŠ” ë¼ìš°í„° êµ¬ì¡°ê°€ í¬ê²Œ ë³€ê²½ëœ app directoryê°€ íƒ‘ì¬ë˜ì—ˆë‹¤. ì˜ˆì œëŠ” Next.js 12ì˜ pages directoryë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì–´ ìˆë‹¤.

<br />

## 7.4 Next.js ë¼ìš°í„°ì™€ ì…ë ¥ í†µí•© í…ŒìŠ¤íŠ¸

### 7.4.1 í…ŒìŠ¤íŠ¸í•  UI ì»´í¬ë„ŒíŠ¸

* `<Header />` ì»´í¬ë„ŒíŠ¸
  * ê¸°ì‚¬ ëª©ë¡ì˜ í—¤ë” ì»´í¬ë„ŒíŠ¸
  * select ë²„íŠ¼ìœ¼ë¡œ ë¼ìš°í„°ë¥¼ ì¡°ì‘í•´ URL ë§¤ê°œë³€ìˆ˜ë¥¼ ë³€ê²½
    
![image](https://github.com/user-attachments/assets/c0738d7e-c8c3-49ba-9a0d-ee6887d348a5)


<br />

### 7.4.2 ì´ˆê¸° í™”ë©´ í…ŒìŠ¤íŠ¸

UI ì»´í¬ë„ŒíŠ¸ì˜ í†µí•© í…ŒìŠ¤íŠ¸ì— ì•ì„œ ì•„ë˜ì™€ ê°™ì€ ì„¤ì • í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë“  í…ŒìŠ¤íŠ¸ì—ì„œ í•„ìš”í•œ ì„¤ì •ì„ í•œ ê³³ì—ì„œ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
* ì„¤ì • í•¨ìˆ˜
  * í…ŒìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
  * ìš”ì†Œ ì·¨ë“ ë° ë°˜í™˜
  * URL ì„¤ì • ë“±..
```ts
function setup(url = "/my/posts?page=1") {
  mockRouter.setCurrentUrl(url);
  render(<Header />);
  const combobox = screen.getByRole("combobox", { name: "ê³µê°œ ì—¬ë¶€" });
  return { combobox };
}
```

* ì„¤ì • í•¨ìˆ˜ë¥¼ í™œìš©í•´ì„œ ì‘ì„±í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œ
```ts
test("ê¸°ë³¸ê°’ìœ¼ë¡œ 'ëª¨ë‘'ê°€ ì„ íƒë˜ì–´ ìˆë‹¤", async () => {
  const { combobox } = setup();
  expect(combobox).toHaveDisplayValue("ëª¨ë‘");
});

test("status?=publicìœ¼ë¡œ ì ‘ì†í•˜ë©´ 'ê³µê°œ'ê°€ ì„ íƒë˜ì–´ ìˆë‹¤", async () => {
  const { combobox } = setup("/my/posts?status=public");
  expect(combobox).toHaveDisplayValue("ê³µê°œ");
});

test("staus?=privateìœ¼ë¡œ ì ‘ì†í•˜ë©´ 'ë¹„ê³µê°œ'ê°€ ì„ íƒë˜ì–´ ìˆë‹¤", async () => {
  const { combobox } = setup("/my/posts?status=private");
  expect(combobox).toHaveDisplayValue("ë¹„ê³µê°œ");
});
```

<br />

### 7.4.3 ì¸í„°ë™ì…˜ í…ŒìŠ¤íŠ¸
ì¸í„°ë™ì…˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì„¤ì • í•¨ìˆ˜ì— userEventë¥¼ í™œìš©í•œ ì¸í„°ë™ì…˜ í•¨ìˆ˜ ì¶”ê°€
* ì„¤ì • í•¨ìˆ˜
```ts
const user = userEvent.setup();

function setup(url = "/my/posts?page=1") {
  mockRouter.setCurrentUrl(url);
  render(<Header />);
  const combobox = screen.getByRole("combobox", { name: "ê³µê°œ ì—¬ë¶€" });
  async function selectOption(label: string) {
    await user.selectOptions(combobox, label);
  }
  return { combobox, selectOption };
}
```
* í…ŒìŠ¤íŠ¸ ì½”ë“œ
```ts
test("ê³µê°œ ì—¬ë¶€ë¥¼ ë³€ê²½í•˜ë©´ statusê°€ ë³€í•œë‹¤", async () => {
  const { selectOption } = setup();
  expect(mockRouter).toMatchObject({ query: { page: "1" } });
  
  // 1. 'ê³µê°œ'ë¥¼ ì„ íƒ
  await selectOption("ê³µê°œ");
  // 2. ê¸°ì¡´ì˜ page=1ì´ ê·¸ëŒ€ë¡œ ìˆëŠ”ì§€,statusê°€ publicì¸ì§€ í•¨ê»˜ ê²€ì¦
  expect(mockRouter).toMatchObject({
    query: { page: "1", status: "public" },
  });
  
  // 3. 'ë¹„ê³µê°œ'ë¥¼ ì„ íƒ
  await selectOption("ë¹„ê³µê°œ");
  // 4. ê¸°ì¡´ì˜ page=1ì´ ê·¸ëŒ€ë¡œ ìˆëŠ”ì§€,statusê°€ privateì¸ì§€ í•¨ê»˜ ê²€ì¦
  expect(mockRouter).toMatchObject({
    query: { page: "1", status: "private" },
  });
});
```

<br />

## 7.5 React Hook Formìœ¼ë¡œ í¼ ì‰½ê²Œ ë‹¤ë£¨ê¸°
> ğŸ’¡ React Hook Form ì´ë€ ?
> 
> í¼ ìƒíƒœì™€ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ê°„í¸í•œ ë°©ë²•ì„ ì œê³µí•˜ëŠ” ë¦¬ì•¡íŠ¸ ê¸°ë°˜ì˜ í¼ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
### 7.5.1 ì œì–´ ì»´í¬ë„ŒíŠ¸
* ì œì–´ ì»´í¬ë„ŒíŠ¸ (Controlled Component)
  * useState ë“±ì„ ì‚¬ìš©í•´ ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ë¡œ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
* ì œì–´ ì»´í¬ë„ŒíŠ¸ë¥¼ í™œìš©í•œ í¼ì˜ íë¦„ 
  1. useStateë¥¼ ì‚¬ìš©í•´ ì…ë ¥ ìš”ì†Œì˜ ê°’ì„ ì €ì¥í•  `ìƒíƒœ ìƒì„±`
  2. onChange ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¡œ `ìƒíƒœ ê°±ì‹ `
  3. ê°±ì‹ ëœ ê°’ì´ ì…ë ¥ ìš”ì†Œì— `ë°˜ì˜`
  ```ts
  const [ value, setValue ] = useState("");
  return (
    <input
      type="search"
      value={value}
      onChange={(event) => {
        setValue(event.currentTarget.value);
      }}
    />
  );
  ```

<br />  

### 7.5.2 ë¹„ì œì–´ ì»´í¬ë„ŒíŠ¸
* ë¹„ì œì–´ ì»´í¬ë„ŒíŠ¸ (Uncontrolled Component)
  * í¼ì„ ì „ì†¡í•  ë•Œ ì…ë ¥ ìš”ì†Œì— ë¸Œë¼ìš°ì € ê³ ìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ê°’ì„ ì°¸ì¡°í•˜ë„ë¡ êµ¬í˜„
  * `ref`ë¥¼ í†µí•´ DOMì˜ ê°’ì„ ì°¸ì¡°
  * DOMì˜ ê°’ì„ ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— value, onChangeë¥¼ ì§€ì •í•˜ì§€ ì•ŠìŒ
  ```ts
  const ref = useRef<HTMLInputElement>(null);
  return <input type="search" name="search" defaultValue="" ref={ref} />
  ```

<br />

### 7.5.3 React Hook Formê³¼ ë¹„ì œì–´ ì»´í¬ë„ŒíŠ¸
React Hook Formì€ ë¹„ì œì–´ ì»´í¬ë„ŒíŠ¸ë¡œ ê³ ì„±ëŠ¥ í¼ì„ ì‰½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ refë‚˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  ì„¤ì •í•´ì¤€ë‹¤.
React Hook Formì„ ì ìš©í•˜ë ¤ë©´ Form ì»´í¬ë„ŒíŠ¸ì— useFormì´ë¼ëŠ” í›…ì„ ì‚¬ìš©í•´ì•¼í•œë‹¤.

useFormì˜ ë°˜í™˜ê°’ì€ `register` í•¨ìˆ˜ì™€ `handleSubmit` í•¨ìˆ˜
```ts
const { register, handleSubmit } = useForm({
  defaultValue: { search: q },
})
```
`register` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ ì…ë ¥ ìš”ì†Œì˜ ê°’ì„ ì°¸ì¡°
```ts
<input type="search" {...register("search")} />
```
`handleSubmit` í•¨ìˆ˜ë¥¼ í™œìš©í•´ ë“±ë¡ëœ ì…ë ¥ ìš”ì†Œì˜ ê°’ì„ ì·¨ë“
```ts
<form 
  onSubmit={handleSubmit((values) => {
    // ì…ë ¥ëœ ê°’ì„ ì·¨ë“
  })}
>
```

[ì°¸ê³ ] React Hook Formì€ ì œì–´ ì»´í¬ë„ŒíŠ¸ë¡œë„ êµ¬í˜„í•  ìˆ˜ ìˆìŒ

<br />

## 7.6 í¼ ìœ íš¨ì„± ê²€ì‚¬ í…ŒìŠ¤íŠ¸
### 7.6.1 í…ŒìŠ¤íŠ¸í•  UI ì»´í¬ë„ŒíŠ¸
* `<PostForm />` ì»´í¬ë„ŒíŠ¸
  * ì‹ ê·œ ê¸°ì‚¬ ì‘ì„± í¼ì„ ê°€ì§„ UI ì»´í¬ë„ŒíŠ¸
  * í¼ ì „ì†¡ ì „ì— ìœ íš¨ì„± ê²€ì‚¬ ì‹¤ì‹œ
  * React Hook Formì„ ì‚¬ìš©

![image](https://github.com/user-attachments/assets/c6a46fd4-ec4a-43c4-b6ac-5146c4f557ed)


<br />

### 7.6.2 ì„¤ê³„ í¬ì¸íŠ¸
* React Hook Formì˜ `handleSubmit` í•¨ìˆ˜
  * ë‘ ê°œì˜ ì¸ìˆ˜ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ
  * ì²« ë²ˆì§¸ ì¸ìˆ˜ -> ìœ íš¨ì„± ê²€ì‚¬ê°€ ì„±ê³µí–ˆì„ ë•Œ ì‚¬ìš©í•  ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì§€ì •
  * ë‘ ë²ˆì§¸ ì¸ìˆ˜ -> ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ ì‚¬ìš©í•  ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì§€ì •
  * ì•„ë˜ì™€ ê°™ì´ Propsì—ì„œ ì·¨ë“í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë„ ì§€ì • ê°€ëŠ¥

  ```ts
  export declare type UseFormHandleSubmit<TFieldValues extends FieldValues> 
  = (onValid: SubmitHandler<TFieldValues>, onInvalid?: SubmitErrorHandler<TFieldValues>) => (e?: React.BaseSyntheticEvent) => Promise<void>;
  ```

  ```ts
  <form
    aria-label={props.title}
    className={styles.module}
    onSubmit={handleSubmit(props.onValid, props.onInvalid)}
  >
  ```
  
* `PostForm` ì»´í¬ë„ŒíŠ¸ì˜ ì±…ì„
  * ì…ë ¥í¼ ì œê³µ
  * ì…ë ¥ ë‚´ìš© ê²€ì¦ (ìœ íš¨ì„± ê²€ì‚¬)
  * ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ ì˜¤ë¥˜ í‘œì‹œ
  * ìœ íš¨í•œ ë‚´ìš©ì´ ì „ì†¡ë˜ë©´ onValid ì‹¤í–‰
  * ìœ ìš”í•˜ì§€ ì•Šì€ ë‚´ìš©ì´ ì „ì†¡ë˜ë©´ onInvalid ì‹¤í–‰

<br />

### 7.6.3 ì¸í„°ë™ì…˜ í…ŒìŠ¤íŠ¸ ì„¤ì •
* ì„¤ì • í•¨ìˆ˜
```ts
function setup() {
  // ë‹¨ì–¸ë¬¸ì— ì‚¬ìš©í•˜ê¸° ìœ„í•œ ëª© í•¨ìˆ˜ë“¤
  const onClickSave = jest.fn();
  const onValid = jest.fn();
  const onInvalid = jest.fn();
  // ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
  render(
    <PostForm
      title="ì‹ ê·œ ê¸°ì‚¬"
      onClickSave={onClickSave}
      onValid={onValid}
      onInvalid={onInvalid}
    />
  );
  // ì œëª©ì„ ì…ë ¥í•˜ëŠ” ì¸í„°ë™ì…˜ í•¨ìˆ˜
  async function typeTitle(title: string) {
    const textbox = screen.getByRole("textbox", { name: "ì œëª©" });
    await user.type(textbox, title);
  }
  // ê¸°ì‚¬ë¥¼ ê³µê°œí•˜ëŠ” ì¸í„°ë™ì…˜ í•¨ìˆ˜
  async function saveAsPublished() {
    await user.click(screen.getByRole("switch", { name: "ê³µê°œ ì—¬ë¶€" }));
    await user.click(screen.getByRole("button", { name: "ê³µê°œí•˜ê¸°" }));
  }
  // ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥í•˜ëŠ” ì¸í„°ë™ì…˜ í•¨ìˆ˜
  async function saveAsDraft() {
    await user.click(screen.getByRole("button", { name: "ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥" }));
  }
  return {
    typeTitle,
    saveAsDraft,
    saveAsPublished,
    onClickSave,
    onValid,
    onInvalid,
  };
}
```

<br />

### 7.6.4 onInvalidê°€ ì‹¤í–‰ë˜ëŠ” í…ŒìŠ¤íŠ¸
* í…ŒìŠ¤íŠ¸ ì½”ë“œ 1 : ì˜¤ë¥˜ ë©”ì‹œì§€ ê²€ì¦

```ts
test("ìœ íš¨í•˜ì§€ ì•Šì€ ë‚´ìš©ì„ í¬í•¨í•´ 'ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥'ì„ ì‹œë„í•˜ë©´ ìœ íš¨ì„± ê²€ì‚¬ ì—ëŸ¬ê°€ í‘œì‹œëœë‹¤", async () => {
  // 1. ì„¤ì • í•¨ìˆ˜ ì‹¤í–‰
  const { saveAsDraft } = setup();
  // 2. ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥ ì‹œë„
  await saveAsDraft();
  // 3. ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ê°€ ë‚˜íƒ€ë‚˜ëŠ” ë° ì‹œê°„ì´ ê±¸ë¦¬ë¯€ë¡œ waitForë¡œ ë‹¨ì–¸ë¬¸ì„ ê³„ì† ì¬ì‹œë„
  await waitFor(() =>
    expect(screen.getByRole("textbox", { name: "ì œëª©" }))
      .toHaveErrorMessage("í•œ ê¸€ì ì´ìƒì˜ ë¬¸ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
  );
});
```
* í…ŒìŠ¤íŠ¸ ì½”ë“œ 2 : ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ê²€ì¦
```ts
test("ìœ íš¨í•˜ì§€ ì•Šì€ ë‚´ìš©ì„ í¬í•¨í•´ 'ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥'ì„ ì‹œë„í•˜ë©´ onInvalid ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ëœë‹¤", async () => {
  // 1. ì„¤ì • í•¨ìˆ˜ ì‹¤í–‰
  const { saveAsDraft, onClickSave, onValid, onInvalid } = setup();
  // 2. ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥ ì‹œë„ 
  await saveAsDraft();
  // 3. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ëëŠ”ì§€ ê²€ì¦
  expect(onClickSave).toHaveBeenCalled();
  expect(onValid).not.toHaveBeenCalled();
  expect(onInvalid).toHaveBeenCalled();
});
```

<br />

### 7.6.5 onValidê°€ ì‹¤í–‰ë˜ëŠ” í…ŒìŠ¤íŠ¸
* í…ŒìŠ¤íŠ¸ ì½”ë“œ
```ts
test("ìœ íš¨í•œ ì…ë ¥ ë‚´ìš©ìœ¼ë¡œ 'ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥'ì„ ì‹œë„í•˜ë©´ onValid ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ëœë‹¤", async () => {
  mockUploadImage();
  // 1. ì„¤ì • í•¨ìˆ˜ ì‹¤í–‰
  const { typeTitle, saveAsDraft, onClickSave, onValid, onInvalid } = setup();
  const { selectImage } = selectImageFile();
  // 2. ì œëª© ì…ë ¥
  await typeTitle("ë‚˜ì˜ ê¸°ì‚¬");
  await selectImage();
  // 3. ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥ ì‹œë„
  await saveAsDraft();
  // 4. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ëëŠ”ì§€ ê²€ì¦
  expect(onClickSave).toHaveBeenCalled();
  expect(onValid).toHaveBeenCalled();
  expect(onInvalid).not.toHaveBeenCalled();
});
```

<br />


### 7.6.6 TIP: ì ‘ê·¼ì„± ê´€ë ¨ ë§¤ì¹˜

* ì ‘ê·¼ì„± ê´€ë ¨ ë§¤ì¹˜ë“¤
  * `toHaveAccessibleName`
  * `toHaveAccessibleDescription`
  * `toHaveErrorMessage`

```ts
test("TextboxWithInfo", async () => {
  const args = {
    title: "ì œëª©",
    info: "0 / 64",
    description: "ì˜ë¬¸ê³¼ ìˆ«ìë¥¼ ì¡°í•©í•˜ì—¬ 64ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”",
    error: "ìœ íš¨í•˜ì§€ ì•Šì€ ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤",
  };
  render(<TextboxWithInfo {...args} />);
  const textbox = screen.getByRole("textbox");
  // labelì˜ htmlForì™€ ì—°ê´€ë¼ ìˆë‹¤.
  expect(textbox).toHaveAccessibleName(args.title);
  // aria-describedbyì™€ ì—°ê´€ë¼ ìˆë‹¤.
  expect(textbox).toHaveAccessibleDescription(args.description);
  // aria-errormessageì™€ ì—°ê´€ë¼ ìˆë‹¤.
  expect(textbox).toHaveErrorMessage(args.error);
});
```
<br />

## 7.7 ì›¹ API ì‘ë‹µì„ ëª© ê°ì²´í™”í•˜ëŠ” MSW
### 7.7.1 ë„¤íŠ¸ì›Œí¬ ê³„ì¸µì˜ ëª© ê°ì²´ë¥¼ ë§Œë“œëŠ” MSW

> ğŸ’¡ MSW (Mock Service Worker) ë€ ?
>
> ë„¤íŠ¸ì›Œí¬ ê³„ì¸µì˜ ëª© ê°ì²´ë¥¼ ë§Œë“œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬.
> ì›¹ APIë¥¼ ê°€ë¡œì±„ì„œ ì„ì˜ì˜ ê°’ìœ¼ë¡œ ë§Œë“  ì‘ë‹µìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—
> ì›¹ APIë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šì•„ë„ ì‘ë‹µì´ ì˜¤ëŠ” ìƒí™©ì„ ì¬í˜„í•  ìˆ˜ ìˆë‹¤.

* ìš”ì²­ í•¸ë“¤ëŸ¬ (request handler)
  * ì›¹ API ìš”ì²­ì„ ê°€ë¡œì±„ê¸° ìœ„í•œ í•¸ë“¤ëŸ¬
  * ì–´ë–¤ ê²½ë¡œì— ëŒ€í•œ ìš”ì²­ì„ ê°€ë¡œì±Œ ê²ƒì¸ì§€ ì–´ë–¤ ì‘ë‹µì„ ë°˜í™˜í•  ê²ƒì¸ì§€ í•¸ë“¤ëŸ¬ì— ì‘ì„±
```ts
import { setupWorker, rest } from "msw";
const worker = setupWorker(
  rest.post("/login", async (req, res, ctx) => {
    const { username } = await req.json();
    return res (
      ctx.json({
        username,
        firstName: "John"
      })
    );
  })
);
```

[ì°¸ê³ ] MSWëŠ” í…ŒìŠ¤íŠ¸ ì‹œ ìƒì„±ëœ ìš”ì²­ì˜ headersë‚˜ queryì˜ ì„¸ë¶€ ë‚´ìš©ê¹Œì§€ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.

<br />

### 7.7.2 ì œìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸°

ìš”ì²­ í•¸ë“¤ëŸ¬ë¥¼ mswì˜ setupServerí•¨ìˆ˜ì— ê°€ë³€ ì¸ìˆ˜ë¡œ ë„˜ê¸°ë©´ ìš”ì²­ì„ ê°€ë¡œì±Œ ìˆ˜ ìˆë‹¤. \
ì œìŠ¤íŠ¸ì—ì„œëŠ” ì„¤ì • í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

* ì„¤ì • í•¨ìˆ˜
  * setupServer í•¨ìˆ˜ëŠ” í…ŒìŠ¤íŠ¸ë§ˆë‹¤ ì„œë²„ë¥¼ ì´ˆê¸°í™”í•˜ê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ë¼ë¦¬ ì˜í–¥ X
```ts
export function setupMockServer(...handlers: RequestHandler[]) {
  const server = setupServer(...handlers);
  beforeAll(() => server.listen());
  afterEach(() => server.resetHandlers());
  afterAll(() => server.close());
  return server;
}
```
* í…ŒìŠ¤íŠ¸ ì½”ë“œ
  * ê° í…ŒìŠ¤íŠ¸ íŒŒì¼ì—ì„œ ì•„ë˜ì™€ ê°™ì´ í•„ìš”í•œ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë¥¼ ë„˜ê²¨ì„œ MSW ì„œë²„ë¥¼ ì„¤ì •
```ts
import * as MyPosts from "@/services/client/MyPosts/__mock__/msw";
setupMockServer(...MyPosts.handlers);
```

<br />

### 7.7.3 Fetch APIì˜ í´ë¦¬í•„

í…ŒìŠ¤íŠ¸ í™˜ê²½ì¸ jsdomì— Fetch APIê°€ ì ìš©ë˜ì§€ ì•Šì€ ë²„ì „ì¼ ê²½ìš° í…ŒìŠ¤íŠ¸ ì½”ë“œì— Fetch APIë¥¼ ì‚¬ìš©í•˜ë©´ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆì§€ë§Œ `whatwg-fetch` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ í•´ê²°í•  ìˆ˜ ìˆìŒ

* `whatwg-fetch`
  * Fetch APIì˜ í´ë¦¬í•„

> ğŸ’¡ í´ë¦¬í•„ (Polyfill) ì´ë€ ?
>
> ë¸Œë¼ìš°ì €ë‚˜ JavaScript í™˜ê²½ì—ì„œ ì•„ì§ ì§€ì›ë˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê±°ë‚˜, íŠ¹ì • ê¸°ëŠ¥ì˜ í˜¸í™˜ì„±ì„ ì œê³µí•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ì½”ë“œ ì¡°ê°\
> í´ë¦¬í•„ì€ ìµœì‹  í‘œì¤€(ì˜ˆ: ìµœì‹  ECMAScript ê¸°ëŠ¥)ì„ êµ¬í˜• ë¸Œë¼ìš°ì €ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

<br />

## 7.8 ì›¹ API í†µí•© í…ŒìŠ¤íŠ¸
### 7.8.1 í…ŒìŠ¤íŠ¸í•  UI ì»´í¬ë„ŒíŠ¸
* `<MyPostsCreate />` ì»´í¬ë„ŒíŠ¸
  * ì‹ ê·œ ê¸°ì‚¬ ì‘ì„± í¼ì„ ë‹´ë‹¹í•˜ëŠ” UI ì»´í¬ë„ŒíŠ¸
  * ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µê³¼í•œ í›„ì˜ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ìƒìœ„ ì»´í¬ë„ŒíŠ¸

<br />

### 7.8.2 ì¸í„°ë™ì…˜ í…ŒìŠ¤íŠ¸ ì„¤ì •
* ì„¤ì • í•¨ìˆ˜
```ts
async function setup() {
  const { container } = render(<Default />);
  //ê¸°ì‚¬ì˜ ë©”ì¸ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ëŠ” í•¨ìˆ˜
  const { selectImage } = selectImageFile();
  
  // ì œëª©ì„ ì…ë ¥í•˜ëŠ” í•¨ìˆ˜
  async function typeTitle(title: string) {
    const textbox = screen.getByRole("textbox", { name: "ì œëª©" });
    await user.type(textbox, title)
  }
  
  //ê³µê°œ ìƒíƒœë¡œ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
  async function saveAsPublished() {
    await user.click(screen.getByRole("switch", { name: "ê³µê°œ ì—¬ë¶€" }));
    await user.click(screen.getByRole("button", { name: "ê³µê°œí•˜ê¸°" }));
    await screen.findByRole("alertdialog");
  }
  
  //ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
  async function saveAsDraft() {
    await user.click(screen.getByRole("button", { name: "ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥" }));
  }
  
  //AlertDialog ì˜ [ë„¤] í˜¹ì€ [ì•„ë‹ˆì˜¤]ë¥¼ ì„ íƒí•˜ëŠ” í•¨ìˆ˜
  async function clickButton(name: "ë„¤" | "ì•„ë‹ˆì˜¤") {
    await user.click(screen.getByRole("button", { name }));
  }
  return {
    container,
    typeTitle,
    saveAsPublished,
    saveAsDraft,
    clickButton,
    selectImage,
  };
}
```

<br />

### 7.8.3 AlertDialog ë Œë”ë§ í…ŒìŠ¤íŠ¸
* `AlertDialog`
  * ê³µê°œ ì§ì „ì—ë§Œ ë Œë”ë§ë˜ëŠ” UI ì»´í¬ë„ŒíŠ¸
  * [ë„¤], [ì•„ë‹ˆì˜¤]ë¥¼ ì„ íƒí•  ìˆ˜ ìˆëŠ” ì»´í¬ë„ŒíŠ¸
  
![image](https://github.com/user-attachments/assets/d75b9f1a-9480-4f28-a850-5877f691e5b1)


* í…ŒìŠ¤íŠ¸ ì½”ë“œ 1 
```ts
test("ê³µê°œë¥¼ ì‹œë„í•˜ë©´ AlertDialogê°€ í‘œì‹œëœë‹¤", async () => {
  const { typeTitle, saveAsPublished, selectImage } = await setup();
  await typeTitle("201");
  await selectImage();
  await saveAsPublished();
  expect(
    screen.getByText("ê¸°ì‚¬ë¥¼ ê³µê°œí•©ë‹ˆë‹¤. ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
  ).toBeInTheDocument();
});

test("[ì•„ë‹ˆì˜¤] ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ AlertDialogê°€ ì‚¬ë¼ì§„ë‹¤", async () => {
  const { typeTitle, saveAsPublished, clickButton, selectImage } =
    await setup();
  await typeTitle("201");
  await selectImage();
  await saveAsPublished();
  await clickButton("ì•„ë‹ˆì˜¤");
  expect(screen.queryByRole("alertdialog")).not.toBeInTheDocument();
});
```
  
* í…ŒìŠ¤íŠ¸ ì½”ë“œ 2 : ìœ íš¨í•˜ì§€ ì•Šì€ ë‚´ìš©ì„ í¬í•¨í•  ê²½ìš°
```ts
  test("ìœ íš¨í•˜ì§€ ì•Šì€ ë‚´ìš©ì„ í¬í•¨í•œ ì±„ë¡œ ì œì¶œí•˜ë©´ AlertDialogê°€ ì‚¬ë¼ì§„ë‹¤", async () => {
  const { saveAsPublished, clickButton, selectImage } = await setup();
  // await typeTitle("201");ã€€ì œëª©ì„ ì…ë ¥í•˜ì§€ ì•Šì€ ìƒíƒœ
  await selectImage();
  await saveAsPublished();
  await clickButton("ë„¤");
  // ì œëª© ì…ë ¥ë€ì´ invalid ìƒíƒœê°€ ëœë‹¤.
  await waitFor(() =>
          expect(
                  screen.getByRole("textbox", { name: "ì œëª©" })
          ).toBeInvalid()
  );
  expect(screen.queryByRole("alertdialog")).not.toBeInTheDocument();
});
```

<br />

### 7.8.4 Toast ë Œë”ë§ í…ŒìŠ¤íŠ¸
* `Toast`
  * ê³µê°œ í˜¹ì€ ì €ì¥ ìš”ì²­ì„ ì‹œë„í•˜ë©´ í‘œì‹œë˜ëŠ” ì»´í¬ë„ŒíŠ¸
  * ìš”ì²­ ì‹œë„ì™€ ìš”ì²­ ì„±ê³µì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ ê°ê° ì‘ì„±


* í…ŒìŠ¤íŠ¸ ì½”ë“œ
```ts
  test("API í†µì‹ ì„ ì‹œë„í•˜ë©´ 'ì €ì¥ ì¤‘ì…ë‹ˆë‹¤...'ê°€ í‘œì‹œëœë‹¤", async () => {
  const { typeTitle, saveAsPublished, clickButton, selectImage } =
          await setup();
  await typeTitle("201");
  await selectImage();
  await saveAsPublished();
  await clickButton("ë„¤");
  await waitFor(() =>
          expect(screen.getByRole("alert")).toHaveTextContent("ì €ì¥ ì¤‘ì…ë‹ˆë‹¤...")
  );
});

test("ê³µê°œì— ì„±ê³µí•˜ë©´ 'ê³µê°œëìŠµë‹ˆë‹¤'ê°€ í‘œì‹œëœë‹¤", async () => {
  const { typeTitle, saveAsPublished, clickButton, selectImage } =
          await setup();
  await typeTitle("hoge");
  await selectImage();
  await saveAsPublished();
  await clickButton("ë„¤");
  await waitFor(() =>
          expect(screen.getByRole("alert")).toHaveTextContent("ê³µê°œëìŠµë‹ˆë‹¤")
  );
});
```
* í…ŒìŠ¤íŠ¸ ì½”ë“œ 3 : ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸ (í•¸ë“¤ëŸ¬ì— ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ë§Œë“¤ê¸°)
```ts
export function handleCreateMyPosts(spy?: jest.Mock<any, any>) {
  return rest.post(path(), async (req, res, ctx) => {
    const data: ApiMyPosts.PostInput = await req.json();
    spy?.({ body: data, headers: req.headers.get("content-type") });
    if (data.title === "500") {
      const err = new HttpError(500).serialize();
      return res(ctx.status(err.status), ctx.json(err));
    }
    return res(ctx.json(createMyPostsData(data.title)));
  });
}

export const handlers = [handleCreateMyPosts()];
```
```ts
setupMockServer(...MyPosts.handlers, ...MyProfile.handlers);
```
```ts
  test("ê³µê°œì— ì‹¤íŒ¨í•˜ë©´ 'ê³µê°œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤'ê°€ í‘œì‹œëœë‹¤", async () => {
  const { typeTitle, saveAsPublished, clickButton, selectImage } =
          await setup();
  await typeTitle("500");
  await selectImage();
  await saveAsPublished();
  await clickButton("ë„¤");
  await waitFor(() =>
          expect(screen.getByRole("alert")).toHaveTextContent("ê³µê°œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")
  );
});
```

<br />

### 7.8.5 í™”ë©´ ì´ë™ í…ŒìŠ¤íŠ¸

* í…ŒìŠ¤íŠ¸ ì½”ë“œ
```ts
  test("ë¹„ê³µê°œ ìƒíƒœë¡œ ì €ì¥ ì‹œ ë¹„ê³µê°œí•œ ê¸°ì‚¬ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤", async () => {
  const { typeTitle, saveAsDraft, selectImage } = await setup();
  await typeTitle("201");
  await selectImage();
  await saveAsDraft();
  await waitFor(() =>
    expect(mockRouter).toMatchObject({ pathname: "/my/posts/201" })
  );
});

test("ê³µê°œì— ì„±ê³µí•˜ë©´ í™”ë©´ì„ ì´ë™í•œë‹¤", async () => {
  const { typeTitle, saveAsPublished, clickButton, selectImage } =
          await setup();
  await typeTitle("201");
  await selectImage();
  await saveAsPublished();
  await clickButton("ë„¤");
  await waitFor(() =>
    expect(mockRouter).toMatchObject({ pathname: "/my/posts/201" })
  );
});
```

> ğŸ’¡ ìƒìœ„ ì»´í¬ë„ŒíŠ¸ëŠ” ì—°ë™ í…ŒìŠ¤íŠ¸, í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ëŠ” ìœ íš¨ì„± ê²€ì‚¬ í…ŒìŠ¤íŠ¸. \
> ì´ë ‡ê²Œ ê° ì»´í¬ë„ŒíŠ¸ë³„ë¡œ **ìì‹ ì˜ ì±…ì„ì—ë§Œ ì§‘ì¤‘í•˜ì—¬ í…ŒìŠ¤íŠ¸**í•˜ë©´ í…ŒìŠ¤íŠ¸ ëª©ì ì€ ë¬¼ë¡  ì»´í¬ë„ŒíŠ¸ ê°„ ì±…ì„ë„ ë¶„ëª…í•´ì§„ë‹¤.

<br />

## 7.9 ì´ë¯¸ì§€ ì—…ë¡œë“œ í†µí•© í…ŒìŠ¤íŠ¸
### 7.9.1 í…ŒìŠ¤íŠ¸í•  UI ì»´í¬ë„ŒíŠ¸

* `<Avatar />` ì»´í¬ë„ŒíŠ¸
  * ì‚¬ìš©ì ì•„ë°”íƒ€ì˜ ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•˜ê³  ë³€ê²½í•˜ëŠ” ì—­í• 
  * ì»´í“¨í„°ì— ì €ì¥ëœ ì´ë¯¸ì§€ ì—…ë¡œë“œ
  * ì—…ë¡œë“œëœ ì´ë¯¸ì§€ í”„ë¡œí•„ ì´ë¯¸ì§€ë¡œ ì ìš©
  

* `<InputFileButton />` ì»´í¬ë„ŒíŠ¸
  * ì»´í“¨í„°ì— ì €ì¥ëœ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•  ìˆ˜ ìˆëŠ” ì»´í¬ë„ŒíŠ¸
  * `<input type="file">` ìš”ì†Œ
 
![image](https://github.com/user-attachments/assets/e83f1028-2345-465c-917d-6a46cc71be61)


```ts
<InputFileButton
  buttonProps={{
    children: "ì´ë¯¸ì§€ ë³€ê²½í•˜ê¸°",
    type: "button",
  }}
  inputProps={{
    "data-testid": "file",
    // pngì™€ jpegë§Œ í—ˆìš©
    accept: "image/png, image/jpeg",
    onChange: onChangeImage,
  }}
/>
```

<br />

### 7.9.2 ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ íë¦„

1. ì´ë¯¸ì§€ ì„ íƒ
2. onChangeImage ì‹¤í–‰
3. ë¸Œë¼ìš°ì € APIì¸ `FileReader`ë¡œ ì´ë¯¸ì§€ ì·¨ë“
4. ì´ë¯¸ì§€ ì—…ë¡œë“œ API í˜¸ì¶œ
5. AWSê°€ ì œê³µí•˜ëŠ” íŒŒì¼ ì €ì¥ì†Œ ì„œë¹„ìŠ¤ì— ì´ë¯¸ì§€ ì €ì¥
6. ì´ë¯¸ì§€ ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ì´ë¯¸ì§€ URLì„ í”„ë¡œí•„ ì´ë¯¸ì§€ srcë¡œ ì‚¬ìš©

```ts
  //handleChangeFileì€ FileReaderë¡œ ì´ë¯¸ì§€ ì·¨ë“
  const onChangeImage = handleChangeFile((_, file) => {
  // ì·¨ë“í•œ ì´ë¯¸ì§€ì˜ ë‚´ìš©ì„ fileì— ì €ì¥í•œë‹¤.
  // uploadImage í•¨ìˆ˜ëŠ” API Routeë¡œ êµ¬í˜„ëœ ì´ë¯¸ì§€ ì—…ë¡œë“œ APIë¥¼ í˜¸ì¶œí•œë‹¤.
  uploadImage({ file })
    .then((data) => {
      const imgPath = `${data.url}/${data.filename}` as PathValue<T, Path<T>>;
      // API ì‘ë‹µì— í¬í•¨ëœ ì´ë¯¸ì§€ URLì„ ê²½ë¡œë¡œ ì§€ì •í•œë‹¤.
      setImageUrl(imgPath);
      setValue(name, imgPath);
      onResolved?.(data);
    })
    .catch(onRejected);
});
```

### 7.9.3 í†µí•© í…ŒìŠ¤íŠ¸ìš© ëª© ê°ì²´ ë§Œë“¤ê¸°

* ë¬¸ì œì  
  * jsdomì€ ë¸Œë¼ìš°ì € APIë¥¼ ì œê³µí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ë¯¸ì§€ ì„ íƒ ë° ì—…ë¡œë“œ APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ 
* í•´ê²°ë°©ì•ˆ
  * ***ëª© í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°***

#### 1. ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ëŠ” ëª© í•¨ìˆ˜

* ë”ë¯¸ ì´ë¯¸ì§€ íŒŒì¼ ì‘ì„±
* ì´ë¯¸ì§€ ì„ íƒ ì¸í„°ë™ì…˜ ì¬í˜„

```ts
export function selectImageFile(
        inputTestId = "file",
        fileName = "hello.png",
        content = "hello"
) {
  // 1. userEventë¥¼ ì´ˆê¸°í™”í•œë‹¤.
  const user = userEvent.setup();
  // 2. ë”ë¯¸ ì´ë¯¸ì§€ íŒŒì¼ì„ ì‘ì„±í•œë‹¤.
  const filePath = [`C:\\fakepath\\${fileName}`];
  const file = new File([content], fileName, { type: "image/png" });
  // 3. renderí•œ ì»´í¬ë„ŒíŠ¸ì—ì„œ data-testid="file"ì¸ inputì„ ì·¨ë“í•œë‹¤.
  const fileInput = screen.getByTestId(inputTestId);
  // 4. user.uploadë¥¼ ì‹¤í–‰í•˜ë©´ í•´ë‹¹ inputì€ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•œ ìƒíƒœê°€ ëœë‹¤.
  const selectImage = () => user.upload(fileInput, file);
  return { fileInput, filePath, selectImage };
}
```

#### 2. ì´ë¯¸ì§€ ì—…ë¡œë“œ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ëª© í•¨ìˆ˜

* ì •í•´ì§„ ì‘ë‹µ ë°˜í™˜

```ts
jest.mock("../fetcher");

export function mockUploadImage(status?: ErrorStatus) {
  if (status && status > 299) {
    return jest
      .spyOn(UploadImage, "uploadImage")
      .mockRejectedValueOnce(new HttpError(status).serialize());
  }
  return jest
    .spyOn(UploadImage, "uploadImage")
    // uploadImageDataëŠ” ì •í•´ì§„ fixture ë°ì´í„°
    .mockResolvedValueOnce(uploadImageData);
}
```

<br />

### 7.9.4 ì—…ë¡œë“œ ì„±ê³µ í…ŒìŠ¤íŠ¸

* í…ŒìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸
```ts
function TestComponent() {
  const { register, setValue } = useForm<PutInput>();
  return BasicLayout(
          <Avatar register={register} setValue={setValue} name="imageUrl" />
);
}
```
* í…ŒìŠ¤íŠ¸ ì½”ë“œ

```ts
test("ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì„±ê³µí•˜ë©´ ì´ë¯¸ì§€ì˜ src ì†ì„±ì´ ë³€ê²½ëœë‹¤", async () => {
  // 1. ì´ë¯¸ì§€ ì—…ë¡œë“œê°€ ì„±ê³µí•˜ë„ë¡ ì„¤ì •í•œë‹¤.
  mockUploadImage();
  // 2. ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•œë‹¤.
  render(<TestComponent />);
  // 3. ì´ë¯¸ì§€ì˜ src ì†ì„±ì´ ë¹„ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.
  expect(screen.getByRole("img").getAttribute("src")).toBeFalsy();
  // 4. ì´ë¯¸ì§€ë¥¼ ì„ íƒí•œë‹¤.
  const { selectImage } = selectImageFile();
  await selectImage();
  // 5. ì´ë¯¸ì§€ì˜ src ì†ì„±ì´ ì±„ì›Œì¡ŒëŠ”ì§€ í™•ì¸í•œë‹¤.
  await waitFor(() =>
    expect(screen.getByRole("img").getAttribute("src")).toBeTruthy()
  );
});
```

<br />

### 7.9.5 ì—…ë¡œë“œ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸

* í…ŒìŠ¤íŠ¸ ì½”ë“œ

```ts
test("ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í•˜ë©´ ê²½ê³ ì°½ì´ í‘œì‹œëœë‹¤", async () => {
  // 1. ì´ë¯¸ì§€ ì—…ë¡œë“œê°€ ì‹¤íŒ¨í•˜ë„ë¡ ì„¤ì •í•œë‹¤.
  mockUploadImage(500);
  // 2. ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•œë‹¤.
  render(<TestComponent />);
  // 3. ì´ë¯¸ì§€ë¥¼ ì„ íƒí•œë‹¤.
  const { selectImage } = selectImageFile();
  await selectImage();
  // 4.ì§€ì •í•œ ë¬¸ìì—´ì´ í¬í•¨ëœ Toastê°€ ë‚˜íƒ€ë‚˜ëŠ”ì§€ ê²€ì¦í•œë‹¤.
  await waitFor(() =>
    expect(screen.getByRole("alert")).toHaveTextContent(
      "ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
    )
  );
});
```

