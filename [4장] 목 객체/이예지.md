# 4. ëª© ê°ì²´

## 4.1 ëª© ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

í…ŒìŠ¤íŠ¸ëŠ” ì‹¤ì œ ì‹¤í–‰ í™˜ê²½ê³¼ ìœ ì‚¬í• ìˆ˜ë¡ ì¬í˜„ì„±ì´ ë†’ì§€ë§Œ, í™˜ê²½ êµ¬ì¶•ì´ ì–´ë ¤ìš¸ ë•Œê°€ ìˆë‹¤. ì´ë•Œ, ëª© ê°ì²´(í…ŒìŠ¤íŠ¸ ë”ë¸”)ë¥¼ ì‚¬ìš©í•˜ë©´ íš¨ìœ¨ì ì¸ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.

### **4.1.1 ëª© ê°ì²´ ìš©ì–´**

ëª© ê°ì²´ë¥¼ ìƒí™©ì— ë”°ë¼ ì„¸ë¶„í™”í•œ ëª…ì¹­

1. **ìŠ¤í…**
    - **ìš©ë„**: ì£¼ë¡œ ëŒ€ì—­ìœ¼ë¡œ ì‚¬ìš©
        - ì˜ì¡´ ì¤‘ì¸ ì»´í¬ë„ŒíŠ¸ì˜ ëŒ€ì—­ ì—­í• 
        - ì •í•´ì§„ ê°’ì„ ë°˜í™˜
        - í…ŒìŠ¤íŠ¸ ëŒ€ìƒì— í• ë‹¹í•˜ëŠ” ì…ë ¥ê°’ ì œê³µ
    - **ì‚¬ìš© ì˜ˆ**: 'ì›¹ APIì—ì„œ íŠ¹ì • ê°’ì„ ë°˜í™˜ ë°›ì•˜ì„ ë•Œ ì´ë ‡ê²Œ ì‘ë™í•´ì•¼ í•œë‹¤'ëŠ” í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©
    - **ì‘ë™ ë°©ì‹**: í…ŒìŠ¤íŠ¸ ëŒ€ìƒì´ ìŠ¤í…ì— ì ‘ê·¼í•˜ë©´ ìŠ¤í…ì€ ì •í•´ì§„ ê°’ì„ ë°˜í™˜
    
   ![Untitled](https://github.com/user-attachments/assets/04d17b35-85e7-4a2e-805d-4d6c592bc1b7)

    
2. **ìŠ¤íŒŒì´**
    - **ìš©ë„**: ì£¼ë¡œ ê¸°ë¡í•˜ëŠ” ìš©ë„
        - í•¨ìˆ˜ë‚˜ ë©”ì„œë“œì˜ í˜¸ì¶œ ê¸°ë¡
        - í˜¸ì¶œëœ íšŸìˆ˜ë‚˜ ì‹¤í–‰ ì‹œ ì‚¬ìš©í•œ ì¸ìˆ˜ ê¸°ë¡
        - í…ŒìŠ¤íŠ¸ ëŒ€ìƒì˜ ì¶œë ¥ í™•ì¸
    - **ì‚¬ìš© ì˜ˆ**: ì¸ìˆ˜ê°€ ë°›ì€ ì½œë°± í•¨ìˆ˜ë¥¼ ê²€ì¦í•  ë•Œ ì‚¬ìš©
        - ì½œë°± í•¨ìˆ˜ê°€ ì‹¤í–‰ëœ íšŸìˆ˜, ì‹¤í–‰ ì‹œ ì‚¬ìš©í•œ ì¸ìˆ˜ ë“±ì„ ê¸°ë¡í•˜ì—¬ ì˜ë„ëŒ€ë¡œ í˜¸ì¶œëëŠ”ì§€ ê²€ì¦
    
    ![Untitled 1](https://github.com/user-attachments/assets/5e74e47e-1726-446f-8440-30b4eec645c4)

    

### 4.1.2 ì œìŠ¤íŠ¸ì˜ ìš©ì–´ í˜¼ë€

ì œìŠ¤íŠ¸(Jest)ì—ì„œëŠ” ìŠ¤í…, ìŠ¤íŒŒì´ë¥¼ êµ¬í˜„í•  ë•Œ ëª© ëª¨ë“ˆ(`jest.mock`) í˜¹ì€ ëª© í•¨ìˆ˜(`jest.fn`, `jest.spyOn`)ë¼ëŠ” APIë¥¼ ì‚¬ìš©í•œë‹¤. 
ì œìŠ¤íŠ¸ëŠ” ì´ë¥¼ ëª¨ë‘ ëª© ê°ì²´ë¼ê³  ë¶€ë¥´ì§€ë§Œ, ì´ ì±…ì—ì„œëŠ” ì•ì„œ ì„¤ëª…í•œ ìŠ¤í…ê³¼ ìŠ¤íŒŒì´ë¥¼ ëª…í™•íˆ êµ¬ë¶„í•˜ì—¬ ì‚¬ìš©í•˜ê³  ì—¬ëŸ¬ ê°€ì§€ ì´ìœ ë¡œ ì‚¬ìš©í•  ë•ŒëŠ” 'ëª© ê°ì²´'ë¼ëŠ” ìš©ì–´ë¥¼ ì‚¬ìš©í•œë‹¤.

## 4.2 ëª© ëª¨ë“ˆì„ í™œìš©í•œ ìŠ¤í…

ì œìŠ¤íŠ¸ì˜ ëª© ëª¨ë“ˆë¡œ ì˜ì¡´ ëª¨ë“ˆì˜ ìŠ¤í…ì„ ë§Œë“œëŠ” ë°©ë²•ì„ ì‚´í´ë³¸ë‹¤.
í…ŒìŠ¤íŠ¸ ì‹œ êµ¬í˜„ì´ ì™„ì„±ë˜ì§€ ì•Šê±°ë‚˜ ìˆ˜ì •ì´ í•„ìš”í•œ ëª¨ë“ˆì— ì˜ì¡´í•  ë•Œ, í•´ë‹¹ ëª¨ë“ˆì„ ëŒ€ì²´í•˜ë©´ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.

![Untitled 2](https://github.com/user-attachments/assets/6f2b56d7-7919-4804-89b1-9fb44e3aea9e)


### 4.2.1 í…ŒìŠ¤íŠ¸í•  í•¨ìˆ˜

ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì€ `sayGoodBye` í•¨ìˆ˜ ëŒ€ì²´í•˜ê¸°

```tsx
export function greet(name: string) {
  return `Hello! ${name}.`;
}

export function sayGoodBye(name: string) {
  throw new Error("ë¯¸êµ¬í˜„");
}
```

### 4.2.2 ì¼ë°˜ì ì¸ í…ŒìŠ¤íŠ¸

1. `greet` í•¨ìˆ˜ ì„±ê³µ ì¼€ì´ìŠ¤
    
    ```tsx
    import { greet } from "./greet";
    
    test("ì¸ì‚¬ë§ì„ ë°˜í™˜í•œë‹¤(ì›ë˜ êµ¬í˜„ëŒ€ë¡œ)", () => {
      expect(greet("Taro")).toBe("Hello! Taro.");
    });
    ```
    
2. `jest.mock` í•¨ìˆ˜ í˜¸ì¶œ
    
    ```tsx
    import { greet } from "./greet";
    
    jest.mock("./greet"); // jest.mock ì¶”ê°€
    
    test("ì¸ì‚¬ë§ì„ ë°˜í™˜í•˜ì§€ ì•ŠëŠ”ë‹¤(ì›ë˜ êµ¬í˜„ê³¼ ë‹¤ë¥´ê²Œ)", () => {
      expect(greet("Taro")).toBe(undefined);
    });
    ```
    
    `greet` í•¨ìˆ˜ undefined ë°˜í™˜
    
    â‡’ `jest.mock` ì´ í…ŒìŠ¤íŠ¸ ì „ì— í˜¸ì¶œë˜ë©´ì„œ í…ŒìŠ¤íŠ¸í•  ëª¨ë“ˆ ëŒ€ì²´í–ˆê¸° ë•Œë¬¸
    

### 4.2.3 ëª¨ë“ˆì„ ìŠ¤í…ìœ¼ë¡œ ëŒ€ì²´í•˜ê¸°

- `jest.mock` ì‚¬ìš©
    
    ```tsx
    import { greet, sayGoodBye } from "./greet";
    
    jest.mock("./greet", () => ({
      sayGoodBye: (name: string) => `Good bye, ${name}.`, // ëŒ€ì²´í•  í•¨ìˆ˜ êµ¬í˜„
    }));
    
    test("ì¸ì‚¬ë§ì´ êµ¬í˜„ë˜ì–´ ìˆì§€ ì•Šë‹¤(ì›ë˜ êµ¬í˜„ê³¼ ë‹¤ë¥´ê²Œ)", () => {
      expect(greet).toBe(undefined);
    });
    
    test("ì‘ë³„ ì¸ì‚¬ë¥¼ ë°˜í™˜í•œë‹¤(ì›ë˜ êµ¬í˜„ê³¼ ë‹¤ë¥´ê²Œ)", () => {
      const message = `${sayGoodBye("Taro")} See you.`;
      expect(message).toBe("Good bye, Taro. See you.");
    });
    ```
    
    â‡’ ê¸°ì¡´ `sayGoodBye` í•¨ìˆ˜ëŠ” Errorë¥¼ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„ë¼ ìˆì—ˆì§€ë§Œ, jest.mock ì„ ì´ìš©í•´ í•¨ìˆ˜ë¥¼ ëŒ€ì²´í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì„±ê³µ
    
    â‡’ ëŒ€ì²´í•œ êµ¬í˜„ë¶€ì— `greet` í•¨ìˆ˜ëŠ” êµ¬í˜„ë˜ì§€ ì•Šì•„, ê¸°ì¡´ì— êµ¬í˜„ëë˜ í•¨ìˆ˜ê°€ `greet` í•¨ìˆ˜ê°€ undefinedë¥¼ ë°˜í™˜
    

### 4.2.4 ëª¨ë“ˆ ì¼ë¶€ë¥¼ ìŠ¤í…ìœ¼ë¡œ ëŒ€ì²´í•˜ê¸°

- `jest.requireActual` í•¨ìˆ˜ ì‚¬ìš©
    
    : ì›ë˜ ëª¨ë“ˆì˜ êµ¬í˜„ì„ import í•˜ì—¬ `sayGoodBye` ë§Œ ëŒ€ì²´
    
    ```tsx
    import { greet, sayGoodBye } from "./greet";
    
    jest.mock("./greet", () => ({
      ...jest.requireActual("./greet"), // ì›ë˜ ëª¨ë“ˆì˜ êµ¬í˜„ import
      sayGoodBye: (name: string) => `Good bye, ${name}.`,
    }));
    
    test("ì¸ì‚¬ë§ì„ ë°˜í™˜í•œë‹¤(ì›ë˜ êµ¬í˜„ëŒ€ë¡œ)", () => {
      expect(greet("Taro")).toBe("Hello! Taro.");
    });
    
    test("ì‘ë³„ ì¸ì‚¬ë¥¼ ë°˜í™˜í•œë‹¤(ì›ë˜ êµ¬í˜„ê³¼ ë‹¤ë¥´ê²Œ)", () => {
      const message = `${sayGoodBye("Taro")} See you.`;
      expect(message).toBe("Good bye, Taro. See you.");
    });
    ```
    

### 4.2.5 ë¼ì´ë¸ŒëŸ¬ë¦¬ ëŒ€ì²´í•˜ê¸°

ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ëŒ€ì²´í•  ë•Œ ëª© ëª¨ë“ˆì„ ê°€ì¥ ë§ì´ ì‚¬ìš©

```tsx
jest.mock("next/router", () => require("next-router-mock"));
```

â‡’ `next/router` ì˜ì¡´ ëª¨ë“ˆ ëŒ€ì‹  `next-router-mock` ë¼ì´ë¸ŒëŸ¬ë¦¬ ì ìš©

<aside>
ğŸ§ ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ë²•

- ESM (ES Module)
    - `import` ë¬¸ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë©°, `export`ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“ˆì„ ë‚´ë³´ëƒ„
- CJS (Common JS Modules)
    - `require()` í•¨ìˆ˜ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë©°, `module.exports` ê°ì²´ë¥¼ í†µí•´ ëª¨ë“ˆì„ ë‚´ë³´ëƒ„
</aside>

## 4.3 ì›¹ API ëª© ê°ì²´ ê¸°ì´ˆ

ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì›¹ API ì„œë²„ì™€ í†µì‹ í•˜ì—¬ ë°ì´í„°ë¥¼ ì·¨ë“í•˜ê³  ê°±ì‹ í•˜ëŠ” ì‘ì—…ì€ í•„ìˆ˜ì ì´ë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ í•  ë•ŒëŠ” ì›¹ API ê´€ë ¨ ì½”ë“œë¥¼ ì›¹ API í´ë¼ì´ì–¸íŠ¸ì˜ ëŒ€ì—­ì¸ ìŠ¤í…ìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•œë‹¤. ìŠ¤í…ì€ ì‹¤ì œ ì‘ë‹µì€ ì•„ë‹ˆì§€ë§Œ, ì‘ë‹µ ì „í›„ì˜ ê´€ë ¨ ì½”ë“œë¥¼ ê²€ì¦í•˜ëŠ” ë° ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœë‹¤.

![Untitled 3](https://github.com/user-attachments/assets/ee0ca7cf-2e63-48c0-8e8a-c124e41a5d87)


### 4.3.1 í…ŒìŠ¤íŠ¸í•  í•¨ìˆ˜

- ì›¹ API í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ ì‹œì—ëŠ” ì•„ë˜ ë‘ ê°€ì§€ë¥¼ ì£¼ë¡œ ì‚¬ìš©
    1. XMLHttpRequest(XHR)ë¥¼ ì‚¬ìš©í•˜ëŠ” Axios ë¼ì´ë¸ŒëŸ¬ë¦¬
    2. ê³µì‹ APIì¸ Fetch API
- ì›¹ API í´ë¼ì´ì–¸íŠ¸ ì˜ˆì‹œ
    
    ```tsx
    // fetchers í•˜ìœ„ì— ìœ„ì¹˜
    export type Profile = {
      id: string;
      name?: string;
      age?: number;
      email: string;
    };
    
    // Fetch APIë¥¼ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì •ë³´ë¥¼ ì·¨ë“í•˜ëŠ” ì›¹ API í´ë¼ì´ì–¸íŠ¸
    export function getMyProfile(): Promise<Profile> {
      return **fetch**("https://myapi.testing.com/my/profile")**.then**(async (res) => {
        const data = await res.json();
        if (!res.ok) {
          throw data;
        }
        return data;
      });
    }
    ```
    
- ì¸ì‚¬ë§ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
    
    ```tsx
    export async function getGreet() {
      const data = await getMyProfile();
      if (!data.name) {
        // 1. nameì´ ì—†ìœ¼ë©´ í•˜ë“œì½”ë”©ëœ ì¸ì‚¬ë§ì„ ë°˜í™˜í•œë‹¤.
        return `Hello, anonymous user!`;
      }
      // 2. nameì´ ìˆìœ¼ë©´ nameì„ í¬í•¨í•œ ì¸ì‚¬ë§ì„ ë°˜í™˜í•œë‹¤.
      return `Hello, ${data.name}!`;
    }
    ```
    
    - `getMyProfile` í•¨ìˆ˜ í˜¸ì¶œ ì‹œ ì›¹ API ìš”ì²­ì´ ë°œìƒí•˜ëŠ”ë°, ì‘ë‹µí•  API ì„œë²„ê°€ ì—†ìœ¼ë©´ `getGreet` í…ŒìŠ¤íŠ¸ ë¶ˆê°€ëŠ¥
        
        â‡’ ì´ë•Œ, ìŠ¤í…ìœ¼ë¡œ `getMyProfile` í•¨ìˆ˜ë¥¼ ëŒ€ì²´í•˜ë©´ ì‹¤ì œ ì„œë²„ ì‘ë‹µ ì—¬ë¶€ ìƒê´€ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
        

### 4.3.2 ì›¹ API í´ë¼ì´ì–¸íŠ¸ ìŠ¤í… êµ¬í˜„

- `jest.spyOn` ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ê°ì²´ ëŒ€ì²´
    
    ```tsx
    **jest.spyOn(í…ŒìŠ¤íŠ¸í•  ê°ì²´, í…ŒìŠ¤íŠ¸í•  í•¨ìˆ˜ ì´ë¦„);**
    
    // ì˜ˆì‹œ
    import * as Fetchers from "./fetchers";
    jest.mock("./fetchers");
    
    jest.spyOn(Fetchers, "getMyProfile"); // Fetchersì— ì •ì˜ë˜ì§€ ì•Šì€ í•¨ìˆ˜ ì´ë¦„ ì§€ì • ì‹œ íƒ€ì… ì˜¤ë¥˜ ë°œìƒ
    ```
    

### 4.3.3 ë°ì´í„° ì·¨ë“ ì„±ê³µ ì¬í˜„ í…ŒìŠ¤íŠ¸

- ë°ì´í„° ì·¨ë“ ì„±ê³µ ì‹œ(reslove) ì‘ë‹µìœ¼ë¡œ ê¸°ëŒ€í•˜ëŠ” ê°ì²´ë¥¼ `mockResolvedValueOnce` ì— ì§€ì •
    
    ```tsx
    // id, emailì„ ê°€ì§„ ì‘ë‹µ ê°ì²´ë¥¼ ì‘ì„±
    jest.spyOn(Fetchers, "getMyProfile").mockResolvedValueOnce({
      id: "xxxxxxx-123456",
      email: "taroyamada@myapi.testing.com",
    });
    
    test("ë°ì´í„° ì·¨ë“ ì„±ê³µ ì‹œ : ì‚¬ìš©ì ì´ë¦„ì´ ì—†ëŠ” ê²½ìš°", async () => {
      // getMyProfileì´ resolve ëì„ ë•Œì˜ ê°’ì„ ì¬í˜„
      jest.spyOn(Fetchers, "getMyProfile").mockResolvedValueOnce({
        id: "xxxxxxx-123456",
        email: "taroyamada@myapi.testing.com",
      });
      await expect(getGreet()).resolves.toBe("Hello, anonymous user!");
    });
    
    test("ë°ì´í„° ì·¨ë“ ì„±ê³µ ì‹œ: ì‚¬ìš©ì ì´ë¦„ì´ ìˆëŠ” ê²½ìš°", async () => {
      jest.spyOn(Fetchers, "getMyProfile").mockResolvedValueOnce({
        id: "xxxxxxx-123456",
        email: "taroyamada@myapi.testing.com",
        name: "taroyamada",
      });
      await expect(getGreet()).resolves.toBe("Hello, taroyamada!");
    });
    ```
    

### 4.3.4 ë°ì´í„° ì·¨ë“ ì‹¤íŒ¨ ì¬í˜„ í…ŒìŠ¤íŠ¸

- `getMyProfile` í•¨ìˆ˜ê°€ ë°ì´í„° ì·¨ë“ì— ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°
    
    ```tsx
    export function getMyProfile(): Promise<Profile> {
      return fetch("https://myapi.testing.com/my/profile").then(async (res) => {
        const data = await res.json();
        if (!res.ok) {
          // 200ë²ˆëŒ€ ì´ì™¸ì˜ ì‘ë‹µì¸ ê²½ìš°
          throw data;
        }
        return data;
      });
    }
    
    // ì˜¤ë¥˜ ê°ì²´ (ì˜ˆì™¸ ë°œìƒ ì‹œ throwë˜ëŠ” ë°ì´í„°)
    export const httpError: HttpError = {
     err : { message: "internal server error" },
    };
    
    // ì˜¤ë¥˜ ê°ì²´ë¥¼ mockResolvedValueOnce ì¸ìˆ˜ë¡œ getMyProfile í•¨ìˆ˜ì˜ rejectë¥¼ ì¬í˜„í•˜ëŠ” ìŠ¤í…
    jest.spyOn(Fetchers, "getMyProfile").mockRejectedValueOnce(httpError);
    
    test("ë°ì´í„° ì·¨ë“ ì‹¤íŒ¨ ì‹œ", async () => {
      // getMyProfileì´ rejectëì„ ë•Œì˜ ê°’ì„ ì¬í˜„
      jest.spyOn(Fetchers, "getMyProfile").mockRejectedValueOnce(httpError);
      await expect(getGreet()).rejects.toMatchObject({
        err: { message: "internal server error" },
      });
    });
    
    test("ë°ì´í„° ì·¨ë“ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ê°€ ë°œìƒí•œ ë°ì´í„°ì™€ í•¨ê»˜ ì˜ˆì™¸ê°€ throwëœë‹¤", async () => {
      expect.assertions(1);
      jest.spyOn(Fetchers, "getMyProfile").mockRejectedValueOnce(httpError);
      try {
        await getGreet();
      } catch (err) {
        expect(err).toMatchObject(httpError);
      }
    });
    ```
    

## 4.4 ì›¹ API ëª© ê°ì²´ ìƒì„± í•¨ìˆ˜

ì‘ë‹µ ë°ì´í„°ë¥¼ ëŒ€ì²´í•˜ëŠ” ëª© ê°ì²´ ìƒì„± í•¨ìˆ˜ì˜ ì‚¬ìš© ë°©ë²•ì„ ì‚´í´ë³¸ë‹¤.

### 4.4.1 í…ŒìŠ¤íŠ¸í•  í•¨ìˆ˜

- `getMyArticleLinksByCategory` : ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê¸°ì‚¬ì˜ ë§í¬ ëª©ë¡ì„ ì·¨ë“í•˜ëŠ” í•¨ìˆ˜
    
    ```tsx
    export async function getMyArticleLinksByCategory(category: string) {
      // ë°ì´í„° ì·¨ë“ í•¨ìˆ˜(Web API í´ë¼ì´ì–¸íŠ¸)
      const data = await getMyArticles();
      // ì·¨ë“í•œ ë°ì´í„° ì¤‘ ì§€ì •í•œ íƒœê·¸ë¥¼ í¬í•¨í•œ ê¸°ì‚¬ë§Œ ê³¨ë¼ë‚¸ë‹¤.
      const articles = data.articles.filter((article) =>
        article.tags.includes(category)
      );
      if (!articles.length) {
        // í•´ë‹¹ë˜ëŠ” ê¸°ì‚¬ê°€ ì—†ìœ¼ë©´ nullì„ ë°˜í™˜í•œë‹¤.
        return null;
      }
      // í•´ë‹¹ë˜ëŠ” ê¸°ì‚¬ê°€ ìˆìœ¼ë©´ ëª©ë¡ìš©ìœ¼ë¡œ ê°€ê³µí•´ì„œ ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤.
      return articles.map((article) => ({
        title: article.title,
        link: `/articles/${article.id}`,
      }));
    }
    ```
    

âœï¸ ì‘ì„±í•  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

- ì§€ì •í•œ íƒœê·¸ë¥¼ ê°€ì§„ ê¸°ì‚¬ê°€ í•œ ê±´ë„ ì—†ìœ¼ë©´ null
- ì§€ì •í•œ íƒœê·¸ë¥¼ ê°€ì§„ ê¸°ì‚¬ê°€ í•œ ê±´ ì´ìƒ ìˆìœ¼ë©´ ë§í¬ ëª©ë¡ ë°˜í™˜
- ë°ì´í„° ì·¨ë“ì— ì‹¤íŒ¨í•˜ë©´ ì˜ˆì™¸ ë°œìƒ

### 4.4.2 ì‘ë‹µì„ êµì²´í•˜ëŠ” ëª© ê°ì²´ ìƒì„± í•¨ìˆ˜

- í”½ìŠ¤ì²˜ ìƒì„±
    - í”½ìŠ¤ì²˜ë€, ì‘ë‹µì„ ì¬í˜„í•˜ê¸° ìœ„í•œ í…ŒìŠ¤í„°ìš© ë°ì´í„°
    
    ```tsx
    export const getMyArticlesData: Articles = {
      articles: [
        {
          id: "howto-testing-with-typescript",
          createdAt: "2022-07-19T22:38:41.005Z",
          tags: ["testing"],
          title: "íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸ ì‘ì„±ë²•",
          body: "í…ŒìŠ¤íŠ¸ ì‘ì„± ì‹œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ í…ŒìŠ¤íŠ¸ì˜ ìœ ì§€ ë³´ìˆ˜ê°€ ì‰¬ì›Œì§„ë‹¤",
        },
        {
          id: "nextjs-link-component",
          createdAt: "2022-07-19T22:38:41.005Z",
          tags: ["nextjs"],
          title: "Next.jsì˜ ë§í¬ ì»´í¬ë„ŒíŠ¸",
          body: "Next.jsëŠ” í™”ë©´ì„ ì´ë™í•  ë•Œ ë§í¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤",
        },
        {
          id: "react-component-testing-with-jest",
          createdAt: "2022-07-19T22:38:41.005Z",
          tags: ["testing", "react"],
          title: "ì œìŠ¤íŠ¸ë¡œ ì‹œì‘í•˜ëŠ” ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸",
          body: "ì œìŠ¤íŠ¸ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì²˜ëŸ¼ UI ì»´í¬ë„ŒíŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤",
        },
      ],
    };
    
    ```
    
- ëª© ê°ì²´ ìƒì„± í•¨ìˆ˜ ì‚¬ìš©
    - ëª© ê°ì²´ ìƒì„± í•¨ìˆ˜ëŠ” í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ì„¤ì •ì„ ìµœëŒ€í•œ ì ì€ ë§¤ê°œë³€ìˆ˜ë¡œ êµì²´í•  ìˆ˜ ìˆê²Œ ë§Œë“œëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ìƒì„±
    
    ```tsx
    function mockGetMyArticles(status = 200) {
      if (status > 299) {
        return jest
          .spyOn(Fetchers, "getMyArticles")
          .mockRejectedValueOnce(httpError);
      }
      return jest
        .spyOn(Fetchers, "getMyArticles")
        .mockResolvedValueOnce(getMyArticlesData);
    }
    ```
    
    - í•´ë‹¹ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‚¬ìš©í•˜ë©´ í…ŒìŠ¤íŠ¸ë§ˆë‹¤ `jest.spyOn` ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë¨

### 4.4.3 ë°ì´í„° ì·¨ë“ ì„±ê³µ ì¬í˜„ í…ŒìŠ¤íŠ¸

```tsx
// í”½ìŠ¤ì²˜ playwright íƒœê·¸ê°€ í¬í•¨ëœ ê¸°ì‚¬ê°€ ì—†ê¸° ë•Œë¬¸ì— null ë°˜í™˜
test("ì§€ì •í•œ íƒœê·¸ë¥¼ í¬í•¨í•œ ê¸°ì‚¬ê°€ í•œ ê±´ë„ ì—†ìœ¼ë©´ nullì„ ë°˜í™˜í•œë‹¤", async () => {
  mockGetMyArticles();
  const data = await getMyArticleLinksByCategory("playwright");
  expect(data).toBeNull(); // toBeNull ë§¤ì²˜ ì‚¬ìš©í•˜ì—¬ ë‹¨ì–¸ë¬¸ ì„±ê³µ
});

// í”½ìŠ¤ì²˜ì— testing íƒœê·¸ê°€ í¬í•¨ëœ ê¸°ì‚¬ê°€ 2ê±´ì´ ìˆì–´ ì„±ê³µ
// ê°€ê³µëœ ë§í¬ URLì´ í¬í•¨ëëŠ”ì§€ë„ ê²€ì¦
test("ì§€ì •í•œ íƒœê·¸ë¥¼ í¬í•¨í•œ ê¸°ì‚¬ê°€ í•œ ê±´ ì´ìƒ ìˆìœ¼ë©´ ë§í¬ ëª©ë¡ì„ ë°˜í™˜í•œë‹¤", async () => {
  mockGetMyArticles();
  const data = await getMyArticleLinksByCategory("testing");
  expect(data).toMatchObject([
    {
      link: "/articles/howto-testing-with-typescript",
      title: "íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸ ì‘ì„±ë²•",
    },
    {
      link: "/articles/react-component-testing-with-jest",
      title: "ì œìŠ¤íŠ¸ë¡œ ì‹œì‘í•˜ëŠ” ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸",
    },
  ]);
});
```

### 4.4.4 ë°ì´í„° ì·¨ë“ ì‹¤íŒ¨ ì¬í˜„ í…ŒìŠ¤íŠ¸

```tsx
test("ë°ì´í„° ì·¨ë“ì— ì‹¤íŒ¨í•˜ë©´ rejectëœë‹¤", async () => {
  mockGetMyArticles(500); // ëª© ê°ì²´ ìƒì„± í•¨ìˆ˜ ì‚¬ìš©í•˜ì—¬ ì‹¤íŒ¨ ì‘ë‹µ ì¬í˜„
  await getMyArticleLinksByCategory("testing").catch((err) => {
    expect(err).toMatchObject({
      err: { message: "internal server error" },
    });
  });
});
```

## 4.5 ëª© í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ìŠ¤íŒŒì´

ì œìŠ¤íŠ¸ì˜ [ëª© í•¨ìˆ˜](https://jestjs.io/docs/jest-object#mock-functions)ë¡œ ìŠ¤íŒŒì´ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³¸ë‹¤.

ìŠ¤íŒŒì´ëŠ” í…ŒìŠ¤íŠ¸ ëŒ€ìƒì— ë°œìƒí•œ ì…ì¶œë ¥ì„ ê¸°ë¡í•˜ëŠ” ê°ì²´ë¡œ ìŠ¤íŒŒì´ì— ê¸°ë¡ëœ ê°’ì„ ê²€ì¦í•˜ë©´ ì˜ë„í•œ ëŒ€ë¡œ ê¸°ëŠ¥ì´ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### 4.5.1 ì‹¤í–‰í–ˆëŠ”ì§€ ê²€ì¦

- `jest.fn` ì‚¬ìš©í•´ì„œ ëª© í•¨ìˆ˜ ì‘ì„±í•˜ë©° í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ í•¨ìˆ˜ë¡œ ì‚¬ìš©
- `toBeCalled` ë§¤ì²˜ë¡œ ì‹¤í–‰ ì—¬ë¶€ ê²€ì¦

```tsx
test("ëª© í•¨ìˆ˜ê°€ ì‹¤í–‰ëë‹¤", () => {
  const mockFn = jest.fn();
  mockFn();
  expect(mockFn).toBeCalled();
});

test("ëª© í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ë‹¤", () => {
  const mockFn = jest.fn();
  expect(mockFn).not.toBeCalled();
});
```

### 4.5.2 ì‹¤í–‰ íšŸìˆ˜ ê²€ì¦

- ëª© í•¨ìˆ˜ëŠ” ì‹¤í–‰ íšŸìˆ˜ë¥¼ ê¸°ë¡
- `toHaveBeenCalledTimes` ë§¤ì²˜ë¡œ í•¨ìˆ˜ í˜¸ì¶œ íšŸìˆ˜ ê²€ì¦

```tsx
test("ëª© í•¨ìˆ˜ëŠ” ì‹¤í–‰ íšŸìˆ˜ë¥¼ ê¸°ë¡í•œë‹¤", () => {
  const mockFn = jest.fn();
  mockFn();
  expect(mockFn).toHaveBeenCalledTimes(1);
  mockFn();
  expect(mockFn).toHaveBeenCalledTimes(2);
});
```

### 4.5.3 ì‹¤í–‰ ì‹œ ì¸ìˆ˜ ê²€ì¦

- ëª© í•¨ìˆ˜ëŠ” ì‹¤í–‰ ì‹œ ì¸ìˆ˜ ê¸°ë¡
- ëª© í•¨ìˆ˜ëŠ” ë‹¤ë¥¸ í•¨ìˆ˜ ì•ˆì— ìˆ¨ê¸¸ ìˆ˜ ìˆìŒ
    
    ```tsx
    test("ëª© í•¨ìˆ˜ëŠ” í•¨ìˆ˜ ì•ˆì—ì„œë„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤", () => {
      const mockFn = jest.fn();
      function greet() {
        mockFn();
      }
      greet();
      expect(mockFn).toHaveBeenCalledTimes(1);
    });
    ```
    
- `toHaveBeenCalledWith` ë§¤ì²˜ë¡œ ì¸ìˆ˜ ê¸°ë¡ ê²€ì¦
    
    ```tsx
    test("ëª© í•¨ìˆ˜ëŠ” ì‹¤í–‰ ì‹œ ì¸ìˆ˜ë¥¼ ê¸°ë¡í•œë‹¤", () => {
      const mockFn = jest.fn();
      function greet(message: string) {
        mockFn(message); // ì¸ìˆ˜ë¥¼ ë°›ì•„ ì‹¤í–‰ëœë‹¤.
      }
      greet("hello"); // "hello"ë¥¼ ì¸ìˆ˜ë¡œ ì‹¤í–‰ëœ ê²ƒì´ mockFnì— ê¸°ë¡ëœë‹¤.
      expect(mockFn).toHaveBeenCalledWith("hello");
    });
    ```
    

### 4.5.4 ìŠ¤íŒŒì´ë¡œ í™œìš©í•˜ëŠ” ë°©ë²•
ëª© í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ìŠ¤íŒŒì´ëŠ” í…ŒìŠ¤íŠ¸ ëŒ€ìƒì˜ ì¸ìˆ˜ì— í•¨ìˆ˜ê°€ ìˆì„ ë•Œ ìœ ìš©í•˜ê²Œ í™œìš©í•  ìˆ˜ ìˆë‹¤.

```tsx
export function greet(name: string, callback?: (message: string) => void) {
  callback?.(`Hello! ${name}`); // ë§¤ê°œë³€ìˆ˜ nameì„ ì‚¬ìš©í•´ì„œ ì½œë°± í•¨ìˆ˜ ì‹¤í–‰
}

// greet.test.ts
test("ëª© í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸ ëŒ€ìƒì˜ ì¸ìˆ˜ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤", () => {
  const mockFn = jest.fn(); 
  greet("Jiro", mockFn); // ëª© í•¨ìˆ˜ ì‹¤í–‰ > mockFnì— ì¸ìˆ˜ ê¸°ë¡
  expect(mockFn).toHaveBeenCalledWith("Hello! Jiro"); // ì¸ìˆ˜ ê¸°ë¡ ê²€ì¦
});
```

### 4.5.5 ì‹¤í–‰ ì‹œ ì¸ìˆ˜ê°€ ê°ì²´ì¼ ë•Œì˜ ê²€ì¦

- ì¸ìˆ˜ê°€ ë°°ì—´ì´ë‚˜ ê°ì²´ì¼ ë•Œë„ ê²€ì¦ ê°€ëŠ¥
    
    ```tsx
    const config = {
      mock: true,
      feature: { spy: true },
    };
    
    export function checkConfig(callback?: (payload: object) => void) {
      callback?.(config); // ìœ„ì—ì„œ ìƒì„±í•œ config ê°ì²´ë¥¼ ì½œë°± í•¨ìˆ˜ì˜ ì¸ìˆ˜ë¡œ ë„˜ê²¨ ì‹¤í–‰
    }
    ```
    
- ì¸ìˆ˜ê°€ ê°ì²´ì¸ ê²½ìš°ë„ `toHaveBeenCalledWith` ë§¤ì²˜ë¡œ ê²€ì¦
    
    ```tsx
    test("ëª© í•¨ìˆ˜ëŠ” ì‹¤í–‰ ì‹œ ì¸ìˆ˜ê°€ ê°ì²´ì¼ ë•Œì—ë„ ê²€ì¦í•  ìˆ˜ ìˆë‹¤", () => {
      const mockFn = jest.fn();
      checkConfig(mockFn);
      expect(mockFn).toHaveBeenCalledWith({
        mock: true,
        feature: { spy: true },
      });
    });
    
    test("expect.objectContainingë¥¼ ì‚¬ìš©í•œ ë¶€ë¶„ ê²€ì¦", () => {
      const mockFn = jest.fn();
      checkConfig(mockFn);
      expect(mockFn).toHaveBeenCalledWith(
        expect.objectContaining({ // ê°ì²´ì˜ ì¼ë¶€ë§Œ ê²€ì¦
          feature: { spy: true },
        })
      );
    });
    ```
    

## 4.6 ì›¹ API ëª© ê°ì²´ì˜ ì„¸ë¶€ ì‚¬í•­

ì…ë ¥ê°’ì„ ê²€ì¦í•œ í›„ ì‘ë‹µ ë°ì´í„°ë¥¼ êµì²´í•˜ëŠ” ëª© ê°ì²´ì˜ êµ¬í˜„ ë°©ë²•ì„ ì•Œì•„ë³¸ë‹¤.

### 4.6.1 í…ŒìŠ¤íŠ¸í•  í•¨ìˆ˜

- `checkLength` ë°ì´í„° ì €ì¥ ì „, ë¬¸ì ê¸¸ì´ë¡œ ìœ íš¨ì„± ê²€ì‚¬

```tsx
export class ValidationError extends Error { }

export function checkLength(value: string) {
  if (value.length === 0) {
    throw new ValidationError("í•œ ê¸€ì ì´ìƒì˜ ë¬¸ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
  }
}
```

### 4.6.2 ëª© ê°ì²´ ìƒì„± í•¨ìˆ˜

```tsx
// checkLength ë¡œ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤ì‹œ
function mockPostMyArticle(input: ArticleInput, status = 200) {
  if (status > 299) {
    return jest
      .spyOn(Fetchers, "postMyArticle")
      .mockRejectedValueOnce(httpError);
  }
  try {
    checkLength(input.title);
    checkLength(input.body);
    return jest
      .spyOn(Fetchers, "postMyArticle")
      .mockResolvedValue({ ...postMyArticleData, ...input });
  } catch (err) {
    return jest
      .spyOn(Fetchers, "postMyArticle")
      .mockRejectedValueOnce(httpError);
  }
}
```

### 4.6.3 í…ŒìŠ¤íŠ¸ ì¤€ë¹„

- íŒ©í† ë¦¬ í•¨ìˆ˜ ìƒì„±
    - ì…ë ¥ìœ¼ë¡œ ë³´ë‚¼ ê°’ì„ ë™ì ìœ¼ë¡œ ìƒì„±
    
    ```tsx
    function inputFactory(input?: Partial<ArticleInput>) {
      return {
        tags: ["testing"],
        title: "íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸ ì‘ì„±ë²•",
        body: "í…ŒìŠ¤íŠ¸ ì‘ì„± ì‹œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ í…ŒìŠ¤íŠ¸ì˜ ìœ ì§€ ë³´ìˆ˜ê°€ ì‰¬ì›Œì§„ë‹¤",
        ...input,
      };
    }
    ```
    
    - `inputFactory` í•¨ìˆ˜ëŠ” ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µê³¼í•˜ëŠ” ë‚´ìš© ë°˜í™˜í•˜ëŠ”ë°,
        
        ì¸ìˆ˜ë¥¼ ë„˜ê²¨ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µê³¼í•˜ì§€ ëª»í•˜ëŠ” ë‚´ìš©ìœ¼ë¡œ ë®ì–´ì¨ì„œ ë°˜í™˜ ê°€ëŠ¥
        
    
    ```tsx
    // ìœ íš¨ì„± ê²€ì‚¬ì— í†µê³¼í•˜ëŠ” ê°ì²´ ë°˜í™˜
    const input = inpustFactory();
    // ìœ íš¨ì„± ê²€ì‚¬ì— í†µê³¼í•˜ì§€ ëª»í•˜ëŠ” ê°ì²´ ë°˜í™˜
    const input = inputFactory({title: "", body: ""});
    ```
    

### 4.6.4 ìœ íš¨ì„± ê²€ì‚¬ ì„±ê³µ ì¬í˜„ í…ŒìŠ¤íŠ¸

```tsx
test("ìœ íš¨ì„± ê²€ì‚¬ì— ì„±ê³µí•˜ë©´ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤", async () => {
  // ìœ íš¨ì„± ê²€ì‚¬ì— í†µê³¼í•˜ëŠ” ì…ë ¥ì„ ì¤€ë¹„í•œë‹¤.
  const input = inputFactory();
  // ì…ë ¥ê°’ì„ í¬í•¨í•œ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ëª© ê°ì²´ë¥¼ ë§Œë“ ë‹¤.
  const mock = mockPostMyArticle(input);
  // inputì„ ì¸ìˆ˜ë¡œ í…ŒìŠ¤íŠ¸í•  í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.
  const data = await postMyArticle(input);
  // ì·¨ë“í•œ ë°ì´í„°ì— **ì…ë ¥ ë‚´ìš©ì´ í¬í•¨ëëŠ”ì§€** ê²€ì¦í•œë‹¤.
  expect(data).toMatchObject(expect.objectContaining(input));
  // **ëª© í•¨ìˆ˜ê°€ í˜¸ì¶œëëŠ”ì§€** ê²€ì¦í•œë‹¤.
  expect(mock).toHaveBeenCalled();
});
```

### 4.6.5 ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì¬í˜„ í…ŒìŠ¤íŠ¸

```tsx
test("ìœ íš¨ì„± ê²€ì‚¬ì— ì‹¤íŒ¨í•˜ë©´ rejectëœë‹¤", async () => {
  expect.assertions(2);
  // ìœ íš¨ì„± ê²€ì‚¬ì— í†µê³¼í•˜ì§€ ëª»í•˜ëŠ” ì…ë ¥ì„ ì¤€ë¹„í•œë‹¤.
  const input = inputFactory({ title: "", body: "" });
  // **ì…ë ¥ê°’ì„ í¬í•¨í•œ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ëª© ê°ì²´**ë¥¼ ë§Œë“ ë‹¤.
  const mock = mockPostMyArticle(input);
  // **ìœ íš¨ì„± ê²€ì‚¬ì— í†µê³¼í•˜ì§€ ëª»í•˜ê³ ** **rejectëëŠ”ì§€ ê²€ì¦**í•œë‹¤.
  await postMyArticle(input).catch((err) => { // checkLengthë¡œ title, body ê¸¸ì´ë¥¼ ê²€ì‚¬í•˜ê³  ìˆì–´ ì‹¤íŒ¨
    // ì—ëŸ¬ ê°ì²´ê°€ rejectëëŠ”ì§€ ê²€ì¦í•œë‹¤.
    expect(err).toMatchObject({ err: { message: expect.anything() } });
    // **ëª© í•¨ìˆ˜ê°€ í˜¸ì¶œëëŠ”ì§€ ê²€ì¦**í•œë‹¤.
    expect(mock).toHaveBeenCalled();
  });
});
```

### 4.6.6 ë°ì´í„° ì·¨ë“ ì‹¤íŒ¨ ì¬í˜„ í…ŒìŠ¤íŠ¸

```tsx
test("ë°ì´í„° ì·¨ë“ì— ì‹¤íŒ¨í•˜ë©´ rejectëœë‹¤", async () => {
  expect.assertions(2);
  // ìœ íš¨ì„± ê²€ì‚¬ì— í†µê³¼í•˜ëŠ” ì…ë ¥ê°’ì„ ì¤€ë¹„í•œë‹¤.
  const input = inputFactory();
  // **ì‹¤íŒ¨ ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ëª© ê°ì²´**ë¥¼ ë§Œë“ ë‹¤.
  const mock = mockPostMyArticle(input, 500); // statusê°€ 500ì´ì—¬ì„œ err ë°˜í™˜
  // **rejectëëŠ”ì§€ ê²€ì¦**í•œë‹¤.
  await postMyArticle(input).catch((err) => {
    // ì—ëŸ¬ ê°ì²´ê°€ rejectëëŠ”ì§€ ê²€ì¦í•œë‹¤.
    expect(err).toMatchObject({ err: { message: expect.anything() } });
    // **ëª© í•¨ìˆ˜ê°€ í˜¸ì¶œëëŠ”ì§€ ê²€ì¦**í•œë‹¤.
    expect(mock).toHaveBeenCalled();
  });
});
```

## 4.7 í˜„ì¬ ì‹œê°ì— ì˜ì¡´í•˜ëŠ” í…ŒìŠ¤íŠ¸

í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í™˜ê²½ì˜ í˜„ì¬ ì‹œê°ì„ ê³ ì •í•˜ì—¬ ì–¸ì œ ì‹¤í–‰í•˜ë”ë¼ë„ ê°™ì€ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

### 4.7.1 í…ŒìŠ¤íŠ¸í•  í•¨ìˆ˜

- ì•„ì¹¨, ì ì‹¬, ì €ë…ë§ˆë‹¤ ë‹¤ë¥¸ ì¸ì‚¬ë§ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
    
    â‡’ ë°˜í™˜ ê°’ì€ ì‹¤í–‰ ì‹œê°ì— ì˜í–¥ì„ ë°›ìŒ 
    
    ```tsx
    export function greetByTime() {
      const hour = new Date().getHours();
      if (hour < 12) {
        return "ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤";
      } else if (hour < 18) {
        return "ì‹ì‚¬ëŠ” í•˜ì…¨ë‚˜ìš”";
      }
      return "ì¢‹ì€ ë°¤ ë˜ì„¸ìš”";
    }
    ```
    

### 4.7.2 í˜„ì¬ ì‹œê° ê³ ì •í•˜ê¸°

- í…ŒìŠ¤íŠ¸ í™˜ê²½ì˜ í˜„ì¬ ì‹œê°ì„ ì„ì˜ì˜ ì‹œê°ìœ¼ë¡œ ê³ ì •í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ë“¤
    - `jest.useFakeTimers` : ì œìŠ¤íŠ¸ì— ê°€ì§œ íƒ€ì´ë¨¸ ì‚¬ìš©í•˜ë„ë¡ ì§€ì‹œí•˜ëŠ” í•¨ìˆ˜
    - `jest.setSystemTime` : ê°€ì§œ íƒ€ì´ë¨¸ì—ì„œ ì‚¬ìš©í•  í˜„ì¬ ì‹œê°ì„ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜
    - `jest.useRealTimers` : ì œìŠ¤íŠ¸ì— ì‹¤ì œ íƒ€ì´ë¨¸ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì§€ì‹œí•˜ëŠ” ì›ìƒ ë³µê·€ í•¨ìˆ˜

```tsx
// beforeEach ì™€ afterEachì—ì„œ íƒ€ì´ë¨¸ë¥¼ êµì²´í•˜ëŠ” ì‘ì—… ìˆ˜í–‰í•˜ì—¬ 
// í…ŒìŠ¤íŠ¸ë§ˆë‹¤ ê°€ì§œ íƒ€ì´ë¨¸ë¥¼ ì„¤ì •í•˜ëŠ” ì½”ë“œ ì œê±°
describe("greetByTime(", () => {
  beforeEach(() => { // ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ ìˆ˜í–‰
    jest.useFakeTimers();
  });

  afterEach(() => { // ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í›„ ìˆ˜í–‰
    jest.useRealTimers();
  });

  test("ì•„ì¹¨ì—ëŠ” 'ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤'ë¥¼ ë°˜í™˜í•œë‹¤", () => {
    jest.setSystemTime(new Date(2023, 4, 23, 8, 0, 0));
    expect(greetByTime()).toBe("ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤");
  });

  test("ì ì‹¬ì—ëŠ” 'ì‹ì‚¬ëŠ” í•˜ì…¨ë‚˜ìš”'ë¥¼ ë°˜í™˜í•œë‹¤", () => {
    jest.setSystemTime(new Date(2023, 4, 23, 14, 0, 0));
    expect(greetByTime()).toBe("ì‹ì‚¬ëŠ” í•˜ì…¨ë‚˜ìš”");
  });

  test("ì €ë…ì—ëŠ” 'ì¢‹ì€ ë°¤ ë˜ì„¸ìš”'ë¥¼ ë°˜í™˜í•œë‹¤", () => {
    jest.setSystemTime(new Date(2023, 4, 23, 21, 0, 0));
    expect(greetByTime()).toBe("ì¢‹ì€ ë°¤ ë˜ì„¸ìš”");
  });
});
```

### 4.7.3 ì„¤ì •ê³¼ íŒŒê¸°

- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ ê³µí†µ ì„¤ì • ì‘ì—…
    - `beforeAll` : ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— í•œ ë²ˆë§Œ ì‹¤í–‰
    - `beforeEach` : ê° í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ì‹¤í–‰
- í…ŒìŠ¤íŠ¸ ì¢…ë£Œ í›„ ê³µí†µ íŒŒê¸° ì‘ì—…
    - `afterAll` : ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œëœ í›„ í•œ ë²ˆë§Œ ì‹¤í–‰
    - `afterEach` : ê° í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œëœ í›„ ì‹¤í–‰
- ì„¤ì • ë° íŒŒê¸° ì‹¤í–‰ íƒ€ì´ë°
    
    ```tsx
    describe("ì„¤ì • ë° íŒŒê¸° íƒ€ì´ë°", () => {
      beforeAll(() => console.log("1 - beforeAll"));
      afterAll(() => console.log("1 - afterAll"));
      beforeEach(() => console.log("1 - beforeEach"));
      afterEach(() => console.log("1 - afterEach"));
    
      test("", () => console.log("1 - test"));
    
      describe("Scoped / Nested block", () => {
        beforeAll(() => console.log("2 - beforeAll"));
        afterAll(() => console.log("2 - afterAll"));
        beforeEach(() => console.log("2 - beforeEach"));
        afterEach(() => console.log("2 - afterEach"));
        
        test("", () => console.log("2 - test"));
      });
    
      // 1 - beforeAll
      // 1 - beforeEach
      // 1 - test
      // 1 - afterEach
      // 2 - beforeAll
      // 1 - beforeEach
      // 2 - beforeEach
      // 2 - test
      // 2 - afterEach
      // 1 - afterEach
      // 2 - afterAll
      // 1 - afterAll
    });
    ```
